<style>
@import url(https://fonts.googleapis.com/css?family=Google+Sans+Text);
html {
    font-family: 'Google Sans Text', 'Google Sans';
    font-size: 14px;
    color-scheme: dark;
    background: light-dark(white, black);
    color: light-dark(black, white);
}
</style>

<script type="importmap">{"imports":{"@modelcontextprotocol/sdk/":"https://esm.sh/@modelcontextprotocol/sdk/dist/esm/","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/es2022/":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/es2022/dist/esm/","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/client/index?target=es2022":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/dist/esm/client/index?target=es2022","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/types?target=es2022":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/dist/esm/types?target=es2022","react-dom/":"https://esm.sh/react-dom@^19.2.3/","react":"https://esm.sh/react@^19.2.3","react/":"https://esm.sh/react@^19.2.3/","lucide-react":"https://esm.sh/lucide-react@^0.562.0","@/index":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3ggfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20vY2xpZW50JzsKaW1wb3J0IEFwcCBmcm9tICdAL0FwcCc7CmNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKTsKaWYgKCFyb290RWxlbWVudCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgZmluZCByb290IGVsZW1lbnQgdG8gbW91bnQgdG8iKTsKfQpjb25zdCByb290ID0gUmVhY3RET00uY3JlYXRlUm9vdChyb290RWxlbWVudCk7CnJvb3QucmVuZGVyKF9qc3goUmVhY3QuU3RyaWN0TW9kZSwgeyBjaGlsZHJlbjogX2pzeChBcHAsIHt9KSB9KSk7Cg==","@":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3ggfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20vY2xpZW50JzsKaW1wb3J0IEFwcCBmcm9tICdAL0FwcCc7CmNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKTsKaWYgKCFyb290RWxlbWVudCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgZmluZCByb290IGVsZW1lbnQgdG8gbW91bnQgdG8iKTsKfQpjb25zdCByb290ID0gUmVhY3RET00uY3JlYXRlUm9vdChyb290RWxlbWVudCk7CnJvb3QucmVuZGVyKF9qc3goUmVhY3QuU3RyaWN0TW9kZSwgeyBjaGlsZHJlbjogX2pzeChBcHAsIHt9KSB9KSk7Cg==","@/types":"data:application/javascript;base64,ZXhwb3J0IHZhciBFbnRpdHlUeXBlOwooZnVuY3Rpb24gKEVudGl0eVR5cGUpIHsKICAgIEVudGl0eVR5cGVbRW50aXR5VHlwZVsiUExBWUVSIl0gPSAwXSA9ICJQTEFZRVIiOwogICAgRW50aXR5VHlwZVtFbnRpdHlUeXBlWyJFTkVNWSJdID0gMV0gPSAiRU5FTVkiOwogICAgRW50aXR5VHlwZVtFbnRpdHlUeXBlWyJCT1NTIl0gPSAyXSA9ICJCT1NTIjsKICAgIEVudGl0eVR5cGVbRW50aXR5VHlwZVsiUFJPSkVDVElMRSJdID0gM10gPSAiUFJPSkVDVElMRSI7CiAgICBFbnRpdHlUeXBlW0VudGl0eVR5cGVbIlBBUlRJQ0xFIl0gPSA0XSA9ICJQQVJUSUNMRSI7CiAgICBFbnRpdHlUeXBlW0VudGl0eVR5cGVbIkNPTExFQ1RJQkxFIl0gPSA1XSA9ICJDT0xMRUNUSUJMRSI7Cn0pKEVudGl0eVR5cGUgfHwgKEVudGl0eVR5cGUgPSB7fSkpOwo=","@/constants":"data:application/javascript;base64,ZXhwb3J0IGNvbnN0IEdSQVZJVFkgPSAwLjY7CmV4cG9ydCBjb25zdCBGUklDVElPTiA9IDAuODU7CmV4cG9ydCBjb25zdCBNT1ZFX1NQRUVEID0gMC44OwpleHBvcnQgY29uc3QgTUFYX1NQRUVEID0gNjsKZXhwb3J0IGNvbnN0IEpVTVBfRk9SQ0UgPSAtMTQ7CmV4cG9ydCBjb25zdCBXQUxMX1NMSURFX1NQRUVEID0gMjsKZXhwb3J0IGNvbnN0IFdBTExfSlVNUF9GT1JDRSA9IHsgeDogOCwgeTogLTEyIH07CmV4cG9ydCBjb25zdCBCT1NTX0xFVkVMUyA9IFs2LCAxMl07CmV4cG9ydCBjb25zdCBUT1RBTF9MRVZFTFMgPSAxMjsKZXhwb3J0IGNvbnN0IEZMT1VOREVSX0xPR09fVVJMID0gJ2h0dHBzOi8vZmxvdW5kZXIubmV3cy9hc3NldHMvaW1nL2xvZ28ucG5nJzsKZXhwb3J0IGNvbnN0IFBMQVlFUl9DT0xPUlMgPSBbCiAgICB7IG5hbWU6ICdPcmlnaW5hbCcsIHZhbHVlOiAnI2ZmZmZmZicgfSwKICAgIHsgbmFtZTogJ0NyaW1zb24nLCB2YWx1ZTogJyNlZjQ0NDQnIH0sCiAgICB7IG5hbWU6ICdFbWVyYWxkJywgdmFsdWU6ICcjMTBiOTgxJyB9LAogICAgeyBuYW1lOiAnQXp1cmUnLCB2YWx1ZTogJyMzYjgyZjYnIH0sCiAgICB7IG5hbWU6ICdBbWV0aHlzdCcsIHZhbHVlOiAnI2E4NTVmNycgfSwKICAgIHsgbmFtZTogJ0dvbGQnLCB2YWx1ZTogJyNlYWIzMDgnIH0sCiAgICB7IG5hbWU6ICdPYnNpZGlhbicsIHZhbHVlOiAnIzQ3NTU2OScgfSwKXTsKZXhwb3J0IGNvbnN0IFRIRU1FUyA9IHsKICAgIElORFVTVFJJQUw6IHsKICAgICAgICBuYW1lOiAnSW5kdXN0cmlhbCBEZWVwJywKICAgICAgICBiYWNrZ3JvdW5kVG9wOiAnIzAyMDYxNycsIC8vIFNsYXRlIDk1MAogICAgICAgIGJhY2tncm91bmRCb3R0b206ICcjMWUyOTNiJywgLy8gU2xhdGUgODAwCiAgICAgICAgcGxhdGZvcm1Db2xvcjogJyMwZjE3MmEnLCAvLyBTbGF0ZSA5MDAKICAgICAgICBwbGF0Zm9ybURldGFpbDogJyMzMzQxNTUnLCAvLyBTbGF0ZSA3MDAKICAgICAgICBhY2NlbnRDb2xvcjogJyMzOGJkZjgnLCAvLyBTa3kgQmx1ZQogICAgICAgIGhhemFyZENvbG9yOiAnI2VmNDQ0NCcsCiAgICB9LAogICAgTUFHTUE6IHsKICAgICAgICBuYW1lOiAnQ29yZSBGb3VuZHJ5JywKICAgICAgICBiYWNrZ3JvdW5kVG9wOiAnIzI3MDgwOCcsIC8vIERhcmsgUmVkCiAgICAgICAgYmFja2dyb3VuZEJvdHRvbTogJyM0NTBhMGEnLCAvLyBSZWQgOTAwCiAgICAgICAgcGxhdGZvcm1Db2xvcjogJyMxYTA1MDUnLAogICAgICAgIHBsYXRmb3JtRGV0YWlsOiAnIzdmMWQxZCcsIC8vIFJlZCA5MDAKICAgICAgICBhY2NlbnRDb2xvcjogJyNmNTllMGInLCAvLyBBbWJlcgogICAgICAgIGhhemFyZENvbG9yOiAnI2ZmMDAwMCcsCiAgICB9LAogICAgQ1lCRVI6IHsKICAgICAgICBuYW1lOiAnTmVvbiBEaXN0cmljdCcsCiAgICAgICAgYmFja2dyb3VuZFRvcDogJyMwZjA1MTgnLCAvLyBEYXJrIFB1cnBsZQogICAgICAgIGJhY2tncm91bmRCb3R0b206ICcjMmUxMDY1JywgLy8gVmlvbGV0IDkwMAogICAgICAgIHBsYXRmb3JtQ29sb3I6ICcjMTcwNjIxJywKICAgICAgICBwbGF0Zm9ybURldGFpbDogJyM0YzFkOTUnLAogICAgICAgIGFjY2VudENvbG9yOiAnI2Q4YjRmZScsIC8vIExhdmVuZGVyCiAgICAgICAgaGF6YXJkQ29sb3I6ICcjZDk0NmVmJywgLy8gRnVzY2hpYQogICAgfSwKICAgIFZPSUQ6IHsKICAgICAgICBuYW1lOiAnVGhlIEV0aGVyZWFsJywKICAgICAgICBiYWNrZ3JvdW5kVG9wOiAnIzAwMDAwMCcsCiAgICAgICAgYmFja2dyb3VuZEJvdHRvbTogJyMxNzE3MTcnLCAvLyBOZXV0cmFsIDkwMAogICAgICAgIHBsYXRmb3JtQ29sb3I6ICcjMDAwMDAwJywKICAgICAgICBwbGF0Zm9ybURldGFpbDogJyM0MDQwNDAnLAogICAgICAgIGFjY2VudENvbG9yOiAnI2ZmZmZmZicsCiAgICAgICAgaGF6YXJkQ29sb3I6ICcjZGMyNjI2JywKICAgIH0KfTsKZXhwb3J0IGNvbnN0IENPTE9SUyA9IHsKICAgIGJhY2tncm91bmQ6ICcjMGEwYTBlJywKICAgIGZvcmVncm91bmQ6ICcjMDAwMDAwJywKICAgIHBsYXllcjogJyNmZmZmZmYnLAogICAgYWNjZW50OiAnI2EzY2RmZicsCiAgICBkYW5nZXI6ICcjZmY0ZDRkJywKICAgIGdvbGQ6ICcjZmZkNzAwJywKICAgIGJvc3M6ICcjZmYyYTJhJywKICAgIHNoYWRvdzogJ3JnYmEoMCwwLDAsMC43KScsCiAgICBsaWdodDogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKScKfTsK","@/utils/geometry":"data:application/javascript;base64,ZXhwb3J0IGNvbnN0IGNoZWNrQUFCQiA9IChyMSwgcjIpID0+IHsKICAgIHJldHVybiAocjEueCA8IHIyLnggKyByMi53ICYmCiAgICAgICAgcjEueCArIHIxLncgPiByMi54ICYmCiAgICAgICAgcjEueSA8IHIyLnkgKyByMi5oICYmCiAgICAgICAgcjEueSArIHIxLmggPiByMi55KTsKfTsKZXhwb3J0IGNvbnN0IHJlc29sdmVDb2xsaXNpb24gPSAoZW50aXR5LCBwbGF0Zm9ybSkgPT4gewogICAgLy8gQ2FsY3VsYXRlIGNlbnRlcnMgYW5kIGhhbGYtd2lkdGhzCiAgICBjb25zdCBlbnRpdHlIYWxmVyA9IGVudGl0eS53IC8gMjsKICAgIGNvbnN0IGVudGl0eUhhbGZIID0gZW50aXR5LmggLyAyOwogICAgY29uc3QgcGxhdEhhbGZXID0gcGxhdGZvcm0udyAvIDI7CiAgICBjb25zdCBwbGF0SGFsZkggPSBwbGF0Zm9ybS5oIC8gMjsKICAgIGNvbnN0IGVudGl0eUNlbnRlclggPSBlbnRpdHkueCArIGVudGl0eUhhbGZXOwogICAgY29uc3QgZW50aXR5Q2VudGVyWSA9IGVudGl0eS55ICsgZW50aXR5SGFsZkg7CiAgICBjb25zdCBwbGF0Q2VudGVyWCA9IHBsYXRmb3JtLnggKyBwbGF0SGFsZlc7CiAgICBjb25zdCBwbGF0Q2VudGVyWSA9IHBsYXRmb3JtLnkgKyBwbGF0SGFsZkg7CiAgICBjb25zdCBkeCA9IGVudGl0eUNlbnRlclggLSBwbGF0Q2VudGVyWDsKICAgIGNvbnN0IGR5ID0gZW50aXR5Q2VudGVyWSAtIHBsYXRDZW50ZXJZOwogICAgY29uc3QgbWluRGlzdFggPSBlbnRpdHlIYWxmVyArIHBsYXRIYWxmVzsKICAgIGNvbnN0IG1pbkRpc3RZID0gZW50aXR5SGFsZkggKyBwbGF0SGFsZkg7CiAgICBpZiAoTWF0aC5hYnMoZHgpIDwgbWluRGlzdFggJiYgTWF0aC5hYnMoZHkpIDwgbWluRGlzdFkpIHsKICAgICAgICBjb25zdCBvdmVybGFwWCA9IG1pbkRpc3RYIC0gTWF0aC5hYnMoZHgpOwogICAgICAgIGNvbnN0IG92ZXJsYXBZID0gbWluRGlzdFkgLSBNYXRoLmFicyhkeSk7CiAgICAgICAgLy8gUHJpb3JpdGl6ZSB2ZXJ0aWNhbCByZXNvbHV0aW9uIChsYW5kaW5nKSBpZiBvdmVybGFwWSBpcyBzbWFsbCBhbmQgd2UgYXJlIGZhbGxpbmcKICAgICAgICAvLyBUaGlzIGhlbHBzIHByZXZlbnQgZ2V0dGluZyBzdHVjayBvbiBzZWFtcyBiZXR3ZWVuIGZsb29yIHRpbGVzCiAgICAgICAgaWYgKG92ZXJsYXBZIDwgb3ZlcmxhcFggfHwgKGVudGl0eS52eSA+IDAgJiYgb3ZlcmxhcFkgPCAyMCkpIHsKICAgICAgICAgICAgaWYgKGR5ID4gMCkgewogICAgICAgICAgICAgICAgLy8gSGl0dGluZyBoZWFkIG9uIGJvdHRvbSBvZiBwbGF0Zm9ybQogICAgICAgICAgICAgICAgZW50aXR5LnkgKz0gb3ZlcmxhcFk7CiAgICAgICAgICAgICAgICBlbnRpdHkudnkgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gTGFuZGluZyBvbiB0b3AKICAgICAgICAgICAgICAgIGVudGl0eS55IC09IG92ZXJsYXBZOwogICAgICAgICAgICAgICAgZW50aXR5LnZ5ID0gMDsKICAgICAgICAgICAgICAgIGVudGl0eS5pc0dyb3VuZGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gSG9yaXpvbnRhbCBjb2xsaXNpb24KICAgICAgICAgICAgaWYgKGR4ID4gMCkgewogICAgICAgICAgICAgICAgZW50aXR5LnggKz0gb3ZlcmxhcFg7CiAgICAgICAgICAgICAgICBlbnRpdHkudnggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZW50aXR5LnggLT0gb3ZlcmxhcFg7CiAgICAgICAgICAgICAgICBlbnRpdHkudnggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9OwpleHBvcnQgY29uc3QgZGlzdGFuY2UgPSAodjEsIHYyKSA9PiB7CiAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHYyLnggLSB2MS54LCAyKSArIE1hdGgucG93KHYyLnkgLSB2MS55LCAyKSk7Cn07CmV4cG9ydCBjb25zdCBnZXRJbnRlcnNlY3Rpb24gPSAocmF5LCBzZWdtZW50KSA9PiB7CiAgICBjb25zdCByX3B4ID0gcmF5LmEueDsKICAgIGNvbnN0IHJfcHkgPSByYXkuYS55OwogICAgY29uc3Qgcl9keCA9IHJheS5iLnggLSByYXkuYS54OwogICAgY29uc3Qgcl9keSA9IHJheS5iLnkgLSByYXkuYS55OwogICAgY29uc3Qgc19weCA9IHNlZ21lbnQuYS54OwogICAgY29uc3Qgc19weSA9IHNlZ21lbnQuYS55OwogICAgY29uc3Qgc19keCA9IHNlZ21lbnQuYi54IC0gc2VnbWVudC5hLng7CiAgICBjb25zdCBzX2R5ID0gc2VnbWVudC5iLnkgLSBzZWdtZW50LmEueTsKICAgIGNvbnN0IHJfbWFnID0gTWF0aC5zcXJ0KHJfZHggKiByX2R4ICsgcl9keSAqIHJfZHkpOwogICAgY29uc3Qgc19tYWcgPSBNYXRoLnNxcnQoc19keCAqIHNfZHggKyBzX2R5ICogc19keSk7CiAgICBpZiAocl9keCAvIHJfbWFnID09PSBzX2R4IC8gc19tYWcgJiYgcl9keSAvIHJfbWFnID09PSBzX2R5IC8gc19tYWcpIHsKICAgICAgICByZXR1cm4gbnVsbDsgLy8gUGFyYWxsZWwKICAgIH0KICAgIGNvbnN0IFQyID0gKHJfZHggKiAoc19weSAtIHJfcHkpICsgcl9keSAqIChyX3B4IC0gc19weCkpIC8gKHNfZHggKiByX2R5IC0gc19keSAqIHJfZHgpOwogICAgY29uc3QgVDEgPSAoc19weCArIHNfZHggKiBUMiAtIHJfcHgpIC8gcl9keDsKICAgIGlmIChUMSA8IDApCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICBpZiAoVDIgPCAwIHx8IFQyID4gMSkKICAgICAgICByZXR1cm4gbnVsbDsKICAgIHJldHVybiB7CiAgICAgICAgeDogcl9weCArIHJfZHggKiBUMSwKICAgICAgICB5OiByX3B5ICsgcl9keSAqIFQxCiAgICB9Owp9Owo=","@/services/LevelGenerator":"data:application/javascript;base64,aW1wb3J0IHsgRW50aXR5VHlwZSB9IGZyb20gJ0AvdHlwZXMnOwppbXBvcnQgeyBCT1NTX0xFVkVMUywgVEhFTUVTIH0gZnJvbSAnQC9jb25zdGFudHMnOwovLyBEZXRlcm1pbmlzdGljIFJhbmRvbSBOdW1iZXIgR2VuZXJhdG9yCmNsYXNzIFNlZWRlZFJhbmRvbSB7CiAgICBjb25zdHJ1Y3RvcihzZWVkKSB7CiAgICAgICAgdGhpcy5zZWVkID0gc2VlZDsKICAgIH0KICAgIC8vIFJldHVybnMgMCB0byAxCiAgICBuZXh0KCkgewogICAgICAgIGNvbnN0IHggPSBNYXRoLnNpbih0aGlzLnNlZWQrKykgKiAxMDAwMDsKICAgICAgICByZXR1cm4geCAtIE1hdGguZmxvb3IoeCk7CiAgICB9CiAgICAvLyBSZXR1cm5zIHJhbmdlIFttaW4sIG1heCkKICAgIHJhbmdlKG1pbiwgbWF4KSB7CiAgICAgICAgcmV0dXJuIG1pbiArIHRoaXMubmV4dCgpICogKG1heCAtIG1pbik7CiAgICB9CiAgICAvLyBSZXR1cm5zIHRydWUvZmFsc2UgYmFzZWQgb24gcHJvYmFiaWxpdHkKICAgIGJvb2woY2hhbmNlID0gMC41KSB7CiAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpIDwgY2hhbmNlOwogICAgfQp9CmNvbnN0IGdldFRoZW1lRm9yTGV2ZWwgPSAobGV2ZWxJbmRleCkgPT4gewogICAgaWYgKGxldmVsSW5kZXggPD0gMykKICAgICAgICByZXR1cm4gVEhFTUVTLklORFVTVFJJQUw7CiAgICBpZiAobGV2ZWxJbmRleCA8PSA2KQogICAgICAgIHJldHVybiBUSEVNRVMuTUFHTUE7CiAgICBpZiAobGV2ZWxJbmRleCA8PSA5KQogICAgICAgIHJldHVybiBUSEVNRVMuQ1lCRVI7CiAgICByZXR1cm4gVEhFTUVTLlZPSUQ7Cn07CmV4cG9ydCBjb25zdCBnZW5lcmF0ZUxldmVsID0gKGxldmVsSW5kZXgpID0+IHsKICAgIGNvbnN0IGlzQm9zcyA9IEJPU1NfTEVWRUxTLmluY2x1ZGVzKGxldmVsSW5kZXgpOwogICAgLy8gTG9uZ2VyIGxldmVsczogQmFzZSA0MDAwICsgc2NhbGluZwogICAgY29uc3Qgd2lkdGggPSBpc0Jvc3MgPyAyMDAwIDogNDAwMCArIChsZXZlbEluZGV4ICogNjAwKTsKICAgIGNvbnN0IGhlaWdodCA9IDE0MDA7IC8vIFRhbGxlciBmb3IgbW9yZSB2ZXJ0aWNhbGl0eQogICAgY29uc3QgdGhlbWUgPSBnZXRUaGVtZUZvckxldmVsKGxldmVsSW5kZXgpOwogICAgLy8gSW5pdGlhbGl6ZSBzZWVkZWQgcmFuZG9tIGZvciB0aGlzIHNwZWNpZmljIGxldmVsCiAgICBjb25zdCBybmcgPSBuZXcgU2VlZGVkUmFuZG9tKGxldmVsSW5kZXggKiAxMjM0NSk7CiAgICBjb25zdCBwbGF0Zm9ybXMgPSBbXTsKICAgIGNvbnN0IGVuZW1pZXMgPSBbXTsKICAgIGNvbnN0IGNvbGxlY3RpYmxlcyA9IFtdOwogICAgY29uc3QgcHJvamVjdGlsZXMgPSBbXTsKICAgIGxldCBib3NzOwogICAgLy8gLS0tIEJvdW5kYXJpZXMgLS0tCiAgICBwbGF0Zm9ybXMucHVzaCh7IHg6IC0yMDAsIHk6IC0yMDAwLCB3OiAyMDAsIGg6IDQwMDAsIHR5cGU6ICdzb2xpZCcsIHJlbmRlclR5cGU6ICdpbnZpc2libGUnIH0pOwogICAgcGxhdGZvcm1zLnB1c2goeyB4OiB3aWR0aCwgeTogLTIwMDAsIHc6IDIwMCwgaDogNDAwMCwgdHlwZTogJ3NvbGlkJywgcmVuZGVyVHlwZTogJ3dhbGwnIH0pOwogICAgLy8gLS0tIExldmVsIEFyY2hpdGVjdHVyZSAtLS0KICAgIGNvbnN0IGdyb3VuZFkgPSBoZWlnaHQgLSAxNTA7CiAgICBpZiAoaXNCb3NzKSB7CiAgICAgICAgLy8gQXJlbmEgRmxvb3IKICAgICAgICBwbGF0Zm9ybXMucHVzaCh7IHg6IDAsIHk6IGdyb3VuZFksIHc6IHdpZHRoLCBoOiA1MDAsIHR5cGU6ICdzb2xpZCcsIHJlbmRlclR5cGU6ICdncm91bmQnIH0pOwogICAgICAgIC8vIEJvc3MgUGxhdGZvcm1zCiAgICAgICAgcGxhdGZvcm1zLnB1c2goeyB4OiAyMDAsIHk6IGhlaWdodCAtIDQwMCwgdzogMzAwLCBoOiAzMCwgdHlwZTogJ3NvbGlkJywgcmVuZGVyVHlwZTogJ3BsYXRmb3JtJyB9KTsKICAgICAgICBwbGF0Zm9ybXMucHVzaCh7IHg6IHdpZHRoIC0gNTAwLCB5OiBoZWlnaHQgLSA0MDAsIHc6IDMwMCwgaDogMzAsIHR5cGU6ICdzb2xpZCcsIHJlbmRlclR5cGU6ICdwbGF0Zm9ybScgfSk7CiAgICAgICAgcGxhdGZvcm1zLnB1c2goeyB4OiB3aWR0aCAvIDIgLSAxNTAsIHk6IGhlaWdodCAtIDYwMCwgdzogMzAwLCBoOiAzMCwgdHlwZTogJ3NvbGlkJywgcmVuZGVyVHlwZTogJ3BsYXRmb3JtJyB9KTsKICAgICAgICAvLyBHdWFyYW50ZWVkIEhlYWx0aCBQYWNrIGluIEJvc3MgQXJlbmEgKExlZnQgc2lkZSkKICAgICAgICBjb2xsZWN0aWJsZXMucHVzaCh7CiAgICAgICAgICAgIGlkOiBgaGVhbHRoLWJvc3MtJHtsZXZlbEluZGV4fWAsCiAgICAgICAgICAgIHR5cGU6IEVudGl0eVR5cGUuQ09MTEVDVElCTEUsCiAgICAgICAgICAgIHg6IDI1MCwgeTogaGVpZ2h0IC0gNTAwLCB3OiA0MCwgaDogNDAsCiAgICAgICAgICAgIHZ4OiAwLCB2eTogMCwgY29sb3I6ICcjMjJjNTVlJywgLy8gR3JlZW4gZm9yIGhlYWx0aAogICAgICAgICAgICBoZWFsdGg6IDEsIG1heEhlYWx0aDogMSwgaXNHcm91bmRlZDogZmFsc2UsIGZhY2luZ1JpZ2h0OiB0cnVlLCBzdGF0ZTogJ2lkbGUnLCBmcmFtZVRpbWVyOiAwLCBqdW1wQ291bnQ6IDAsIGludmluY2libGVUaW1lcjogMAogICAgICAgIH0pOwogICAgICAgIC8vIEV4dHJhIG9uZSBmb3IgQm9zcyAyIChSaWdodCBzaWRlKQogICAgICAgIGlmIChsZXZlbEluZGV4ID09PSAxMikgewogICAgICAgICAgICBjb2xsZWN0aWJsZXMucHVzaCh7CiAgICAgICAgICAgICAgICBpZDogYGhlYWx0aC1ib3NzLTItJHtsZXZlbEluZGV4fWAsCiAgICAgICAgICAgICAgICB0eXBlOiBFbnRpdHlUeXBlLkNPTExFQ1RJQkxFLAogICAgICAgICAgICAgICAgeDogd2lkdGggLSAyOTAsIHk6IGhlaWdodCAtIDUwMCwgdzogNDAsIGg6IDQwLAogICAgICAgICAgICAgICAgdng6IDAsIHZ5OiAwLCBjb2xvcjogJyMyMmM1NWUnLAogICAgICAgICAgICAgICAgaGVhbHRoOiAxLCBtYXhIZWFsdGg6IDEsIGlzR3JvdW5kZWQ6IGZhbHNlLCBmYWNpbmdSaWdodDogdHJ1ZSwgc3RhdGU6ICdpZGxlJywgZnJhbWVUaW1lcjogMCwganVtcENvdW50OiAwLCBpbnZpbmNpYmxlVGltZXI6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGlzRmluYWxCb3NzID0gbGV2ZWxJbmRleCA9PT0gMTI7CiAgICAgICAgYm9zcyA9IHsKICAgICAgICAgICAgaWQ6IGBib3NzLSR7bGV2ZWxJbmRleH1gLAogICAgICAgICAgICB0eXBlOiBFbnRpdHlUeXBlLkJPU1MsCiAgICAgICAgICAgIHg6IHdpZHRoIC0gNDAwLAogICAgICAgICAgICB5OiBoZWlnaHQgLSA1MDAsCiAgICAgICAgICAgIHc6IDEyMCwKICAgICAgICAgICAgaDogMTIwLAogICAgICAgICAgICB2eDogMCwKICAgICAgICAgICAgdnk6IDAsCiAgICAgICAgICAgIGNvbG9yOiBpc0ZpbmFsQm9zcyA/ICcjYTg1NWY3JyA6IHRoZW1lLmhhemFyZENvbG9yLCAvLyBQdXJwbGUgZm9yIGZpbmFsIGJvc3MsIFJlZCBmb3IgZmlyc3QKICAgICAgICAgICAgaGVhbHRoOiBpc0ZpbmFsQm9zcyA/IDgwIDogNTAsCiAgICAgICAgICAgIG1heEhlYWx0aDogaXNGaW5hbEJvc3MgPyA4MCA6IDUwLAogICAgICAgICAgICBpc0dyb3VuZGVkOiBmYWxzZSwKICAgICAgICAgICAgZmFjaW5nUmlnaHQ6IGZhbHNlLAogICAgICAgICAgICBzdGF0ZTogJ2lkbGUnLAogICAgICAgICAgICBmcmFtZVRpbWVyOiAwLAogICAgICAgICAgICBqdW1wQ291bnQ6IDAsCiAgICAgICAgICAgIGludmluY2libGVUaW1lcjogMCwKICAgICAgICAgICAgcGhhc2U6IDEsCiAgICAgICAgICAgIGF0dGFja1RpbWVyOiAwLAogICAgICAgICAgICBkYXNoU3RhdGU6ICdhaW1pbmcnLAogICAgICAgICAgICB0aXJlZFRpbWVyOiAwCiAgICAgICAgfTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIC8vIFByb2NlZHVyYWwgKERldGVybWluaXN0aWMpIEdlbmVyYXRpb24KICAgICAgICBsZXQgY3ggPSAwOwogICAgICAgIC8vIDEuIFNhZmUgU3RhcnQgWm9uZQogICAgICAgIC8vIEZvcmNlIExldmVsIDQgdG8gaGF2ZSBhIGxvbmdlciBzYWZlIHN0YXJ0IG9yIGVhc2llciBmaXJzdCBqdW1wCiAgICAgICAgY29uc3Qgc3RhcnRab25lV2lkdGggPSBsZXZlbEluZGV4ID09PSA0ID8gMTIwMCA6IDgwMDsKICAgICAgICBwbGF0Zm9ybXMucHVzaCh7IHg6IGN4LCB5OiBncm91bmRZLCB3OiBzdGFydFpvbmVXaWR0aCwgaDogNTAwLCB0eXBlOiAnc29saWQnLCByZW5kZXJUeXBlOiAnZ3JvdW5kJyB9KTsKICAgICAgICBjeCArPSBzdGFydFpvbmVXaWR0aDsKICAgICAgICB3aGlsZSAoY3ggPCB3aWR0aCAtIDgwMCkgewogICAgICAgICAgICBsZXQgc2VjdGlvblR5cGUgPSBybmcucmFuZ2UoMCwgMTApOwogICAgICAgICAgICAvLyBFbnN1cmUgTGV2ZWwgNCdzIGZpcnN0IHNlY3Rpb24gaXMgbm90IGEgbWFzc2l2ZSBwaXQKICAgICAgICAgICAgaWYgKGxldmVsSW5kZXggPT09IDQgJiYgY3ggPT09IHN0YXJ0Wm9uZVdpZHRoKSB7CiAgICAgICAgICAgICAgICBzZWN0aW9uVHlwZSA9IDU7IC8vIEZvcmNlIEhpZ2gvTG93IGdyb3VuZCBvciBTdGFuZGFyZCBpbnN0ZWFkIG9mIFBpdCAoMC0zKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzZWN0aW9uVHlwZSA8IDMpIHsKICAgICAgICAgICAgICAgIC8vIEEuIFRoZSBQaXQgKE5vIGdyb3VuZCwganVzdCBmbG9hdGluZyBwbGF0Zm9ybXMpCiAgICAgICAgICAgICAgICBjb25zdCBnYXBTaXplID0gcm5nLnJhbmdlKDYwMCwgOTAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IG51bVBsYXRzID0gTWF0aC5mbG9vcihnYXBTaXplIC8gMjIwKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtUGxhdHM7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHB4ID0gY3ggKyA1MCArIChpICogMjIwKSArIHJuZy5yYW5nZSgwLCAzMCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHkgPSBncm91bmRZIC0gcm5nLnJhbmdlKDEwMCwgMzAwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwdyA9IHJuZy5yYW5nZSgxMjAsIDIwMCk7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1zLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiBweCwgeTogcHksIHc6IHB3LCBoOiAzMCwgdHlwZTogJ3NvbGlkJywgcmVuZGVyVHlwZTogJ3BsYXRmb3JtJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChybmcuYm9vbCgwLjQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW1pZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYGZseWVyLSR7cHh9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IEVudGl0eVR5cGUuRU5FTVksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlOiAnZmx5ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogcHgsIHk6IHB5IC0gMjAwLCB3OiA1MCwgaDogNDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2eDogMCwgdnk6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWUuYWNjZW50Q29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFsdGg6IDIsIG1heEhlYWx0aDogMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzR3JvdW5kZWQ6IGZhbHNlLCBmYWNpbmdSaWdodDogZmFsc2UsIHN0YXRlOiAnaWRsZScsIGZyYW1lVGltZXI6IDAsIGp1bXBDb3VudDogMCwgaW52aW5jaWJsZVRpbWVyOiAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGN4ICs9IGdhcFNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoc2VjdGlvblR5cGUgPCA2KSB7CiAgICAgICAgICAgICAgICAvLyBCLiBIaWdoIEdyb3VuZCAvIExvdyBHcm91bmQKICAgICAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHJuZy5yYW5nZSg1MDAsIDkwMCk7CiAgICAgICAgICAgICAgICBwbGF0Zm9ybXMucHVzaCh7IHg6IGN4LCB5OiBncm91bmRZLCB3OiBsZW5ndGgsIGg6IDUwMCwgdHlwZTogJ3NvbGlkJywgcmVuZGVyVHlwZTogJ2dyb3VuZCcgfSk7CiAgICAgICAgICAgICAgICBjb25zdCBwbGF0SCA9IDQwOwogICAgICAgICAgICAgICAgY29uc3QgcGxhdFkgPSBncm91bmRZIC0gMzAwOwogICAgICAgICAgICAgICAgcGxhdGZvcm1zLnB1c2goeyB4OiBjeCArIDEwMCwgeTogcGxhdFksIHc6IGxlbmd0aCAtIDIwMCwgaDogcGxhdEgsIHR5cGU6ICdzb2xpZCcsIHJlbmRlclR5cGU6ICdwbGF0Zm9ybScgfSk7CiAgICAgICAgICAgICAgICBlbmVtaWVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBgdHVycmV0LSR7Y3h9YCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiBFbnRpdHlUeXBlLkVORU1ZLAogICAgICAgICAgICAgICAgICAgIHN1YnR5cGU6ICd0dXJyZXQnLAogICAgICAgICAgICAgICAgICAgIHg6IGN4ICsgKGxlbmd0aCAvIDIpLCB5OiBwbGF0WSAtIDUwLCB3OiA1MCwgaDogNTAsCiAgICAgICAgICAgICAgICAgICAgdng6IDAsIHZ5OiAwLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZS5oYXphcmRDb2xvciwKICAgICAgICAgICAgICAgICAgICBoZWFsdGg6IDQsIG1heEhlYWx0aDogNCwKICAgICAgICAgICAgICAgICAgICBpc0dyb3VuZGVkOiB0cnVlLCBmYWNpbmdSaWdodDogZmFsc2UsIHN0YXRlOiAnaWRsZScsIGZyYW1lVGltZXI6IDAsIGp1bXBDb3VudDogMCwgaW52aW5jaWJsZVRpbWVyOiAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGN4ICs9IGxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEMuIFN0YW5kYXJkIEJyb2tlbiBHcm91bmQKICAgICAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHJuZy5yYW5nZSgzMDAsIDcwMCk7CiAgICAgICAgICAgICAgICBwbGF0Zm9ybXMucHVzaCh7IHg6IGN4LCB5OiBncm91bmRZLCB3OiBsZW5ndGgsIGg6IDUwMCwgdHlwZTogJ3NvbGlkJywgcmVuZGVyVHlwZTogJ2dyb3VuZCcgfSk7CiAgICAgICAgICAgICAgICBpZiAobGVuZ3RoID4gNDAwKSB7CiAgICAgICAgICAgICAgICAgICAgZW5lbWllcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBwYXRyb2wtJHtjeH1gLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBFbnRpdHlUeXBlLkVORU1ZLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlOiAncGF0cm9sbGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgeDogY3ggKyAyMDAsIHk6IGdyb3VuZFkgLSA2MCwgdzogNjAsIGg6IDYwLAogICAgICAgICAgICAgICAgICAgICAgICB2eDogMCwgdnk6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnI2ZmZmZmZicsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWx0aDogMywgbWF4SGVhbHRoOiAzLAogICAgICAgICAgICAgICAgICAgICAgICBpc0dyb3VuZGVkOiB0cnVlLCBmYWNpbmdSaWdodDogcm5nLmJvb2woKSwgc3RhdGU6ICdpZGxlJywgZnJhbWVUaW1lcjogMCwganVtcENvdW50OiAwLCBpbnZpbmNpYmxlVGltZXI6IDAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGN4ICs9IGxlbmd0aCArIHJuZy5yYW5nZSg1MCwgMTgwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBSYW5kb20gZmxvYXRpbmcgcGxhdGZvcm1zIHRocm91Z2hvdXQKICAgICAgICAgICAgaWYgKHJuZy5ib29sKDAuMykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHB4ID0gY3ggLSAxMDA7CiAgICAgICAgICAgICAgICBjb25zdCBweSA9IGdyb3VuZFkgLSBybmcucmFuZ2UoMjAwLCA1MDApOwogICAgICAgICAgICAgICAgcGxhdGZvcm1zLnB1c2goewogICAgICAgICAgICAgICAgICAgIHg6IHB4LCB5OiBweSwgdzogcm5nLnJhbmdlKDEwMCwgMTUwKSwgaDogMjAsIHR5cGU6ICdzb2xpZCcsIHJlbmRlclR5cGU6ICdwbGF0Zm9ybScKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgLy8gSGVhbHRoIFBhY2sgKHJlcGxhY2luZyBoZWFydCBsb2dpYyBmb3IgY2xhcml0eSkKICAgICAgICAgICAgICAgIGlmIChybmcuYm9vbCgwLjUpKSB7CiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlibGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBpZDogYGhlYWx0aC0ke3B4fWAsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IEVudGl0eVR5cGUuQ09MTEVDVElCTEUsCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHB4ICsgMjAsIHk6IHB5IC0gNTAsIHc6IDMwLCBoOiAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgdng6IDAsIHZ5OiAwLCBjb2xvcjogJyMyMmM1NWUnLCAvLyBHcmVlbiBIZWFsdGggUGFjawogICAgICAgICAgICAgICAgICAgICAgICBoZWFsdGg6IDEsIG1heEhlYWx0aDogMSwgaXNHcm91bmRlZDogZmFsc2UsIGZhY2luZ1JpZ2h0OiB0cnVlLCBzdGF0ZTogJ2lkbGUnLCBmcmFtZVRpbWVyOiAwLCBqdW1wQ291bnQ6IDAsIGludmluY2libGVUaW1lcjogMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIEZpbmFsIEVuZCBab25lCiAgICAgICAgcGxhdGZvcm1zLnB1c2goeyB4OiBjeCwgeTogZ3JvdW5kWSwgdzogODAwLCBoOiA1MDAsIHR5cGU6ICdzb2xpZCcsIHJlbmRlclR5cGU6ICdncm91bmQnIH0pOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgICBpZDogbGV2ZWxJbmRleCwKICAgICAgICBuYW1lOiBpc0Jvc3MgPyBgQk9TUzogJHt0aGVtZS5uYW1lfWAgOiBgJHt0aGVtZS5uYW1lfSAtIFpvbmUgJHtsZXZlbEluZGV4fWAsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIHRoZW1lLAogICAgICAgIHBsYXRmb3JtcywKICAgICAgICBlbmVtaWVzLAogICAgICAgIGNvbGxlY3RpYmxlcywKICAgICAgICBwcm9qZWN0aWxlcywKICAgICAgICBib3NzLAogICAgICAgIHN0YXJ0UG9zOiB7IHg6IDIwMCwgeTogaGVpZ2h0IC0gNDAwIH0sCiAgICAgICAgZW5kUG9zOiB7IHg6IHdpZHRoIC0gMjAwLCB5OiBoZWlnaHQgLSA0MDAgfQogICAgfTsKfTsK","@/components/Game":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCB7IHVzZVJlZiwgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7CmltcG9ydCB7IFNwYXJrbGVzLCBUZXJtaW5hbCB9IGZyb20gJ2x1Y2lkZS1yZWFjdCc7CmltcG9ydCB7IEVudGl0eVR5cGUgfSBmcm9tICdAL3R5cGVzJzsKaW1wb3J0IHsgR1JBVklUWSwgRlJJQ1RJT04sIE1PVkVfU1BFRUQsIE1BWF9TUEVFRCwgSlVNUF9GT1JDRSwgRkxPVU5ERVJfTE9HT19VUkwsIFRPVEFMX0xFVkVMUywgQ09MT1JTIH0gZnJvbSAnQC9jb25zdGFudHMnOwppbXBvcnQgeyBjaGVja0FBQkIsIHJlc29sdmVDb2xsaXNpb24gfSBmcm9tICdAL3V0aWxzL2dlb21ldHJ5JzsKaW1wb3J0IHsgZ2VuZXJhdGVMZXZlbCB9IGZyb20gJ0Avc2VydmljZXMvTGV2ZWxHZW5lcmF0b3InOwppbXBvcnQgeyBhdWRpb01hbmFnZXIgfSBmcm9tICdAL3V0aWxzL2F1ZGlvJzsKY29uc3QgZHJhd0JhY2tncm91bmQgPSAoY3R4LCB3aWR0aCwgaGVpZ2h0LCB0aGVtZSkgPT4gewogICAgLy8gRmlsbCBiYWNrZ3JvdW5kCiAgICBjb25zdCBncmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBoZWlnaHQpOwogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIHRoZW1lLmJhY2tncm91bmRUb3ApOwogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIHRoZW1lLmJhY2tncm91bmRCb3R0b20pOwogICAgY3R4LmZpbGxTdHlsZSA9IGdyYWRpZW50OwogICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgLy8gU3RhdGljIGFtYmllbnQgc3RhcnMvZHVzdAogICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMDUpJzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDA7IGkrKykgewogICAgICAgIC8vIFBzZXVkby1yYW5kb20gZGV0ZXJtaW5pc3RpYyBwb3NpdGlvbnMgc28gdGhleSBkb24ndCBqaXR0ZXIKICAgICAgICBjb25zdCB4ID0gKGkgKiAxMzcuNSkgJSB3aWR0aDsKICAgICAgICBjb25zdCB5ID0gKGkgKiAyOTMuMykgJSBoZWlnaHQ7CiAgICAgICAgY3R4LmZpbGxSZWN0KHgsIHksIDIsIDIpOwogICAgfQp9OwpleHBvcnQgY29uc3QgR2FtZSA9ICh7IHNldHRpbmdzLCBvbkV4aXQsIG9uV2luIH0pID0+IHsKICAgIGNvbnN0IGNhbnZhc1JlZiA9IHVzZVJlZihudWxsKTsKICAgIGNvbnN0IFtsZXZlbEluZGV4LCBzZXRMZXZlbEluZGV4XSA9IHVzZVN0YXRlKDEpOwogICAgLy8gSGVhbHRoIFVJIHN0YXRlIC0gc3luY2VkIHdpdGggZ2FtZVN0YXRlLmN1cnJlbnQucGxheWVyLmhlYWx0aAogICAgY29uc3QgW2hlYWx0aCwgc2V0SGVhbHRoXSA9IHVzZVN0YXRlKDUpOwogICAgY29uc3QgW3BhdXNlZCwgc2V0UGF1c2VkXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpOwogICAgY29uc3QgW2dhbWVPdmVyLCBzZXRHYW1lT3Zlcl0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICAvLyBEZXYgVGVybWluYWwgU3RhdGUKICAgIGNvbnN0IFtzaG93VGVybWluYWwsIHNldFNob3dUZXJtaW5hbF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICBjb25zdCBbdGVybUlucHV0LCBzZXRUZXJtSW5wdXRdID0gdXNlU3RhdGUoJycpOwogICAgY29uc3QgW3Rlcm1Mb2csIHNldFRlcm1Mb2ddID0gdXNlU3RhdGUoWyc+IEZsb3VuZGVyIERldiBDb25zb2xlIHYxLjAnXSk7CiAgICBjb25zdCB0ZXJtaW5hbElucHV0UmVmID0gdXNlUmVmKG51bGwpOwogICAgLy8gQXNzZXRzCiAgICBjb25zdCBwbGF5ZXJJbWFnZSA9IHVzZVJlZihuZXcgSW1hZ2UoKSk7CiAgICBjb25zdCB0aW50ZWRQbGF5ZXJDYW52YXMgPSB1c2VSZWYobnVsbCk7CiAgICAvLyBHYW1lIFN0YXRlIFJlZnMKICAgIGNvbnN0IGdhbWVTdGF0ZSA9IHVzZVJlZih7CiAgICAgICAgbGV2ZWw6IG51bGwsCiAgICAgICAgcGxheWVyOiB7CiAgICAgICAgICAgIGlkOiAncGxheWVyJywKICAgICAgICAgICAgdHlwZTogRW50aXR5VHlwZS5QTEFZRVIsCiAgICAgICAgICAgIHg6IDAsIHk6IDAsIHc6IDQwLCBoOiA0MCwKICAgICAgICAgICAgdng6IDAsIHZ5OiAwLAogICAgICAgICAgICBjb2xvcjogQ09MT1JTLnBsYXllciwKICAgICAgICAgICAgaGVhbHRoOiA1LCBtYXhIZWFsdGg6IDUsCiAgICAgICAgICAgIGlzR3JvdW5kZWQ6IGZhbHNlLAogICAgICAgICAgICBmYWNpbmdSaWdodDogdHJ1ZSwKICAgICAgICAgICAgc3RhdGU6ICdpZGxlJywKICAgICAgICAgICAgZnJhbWVUaW1lcjogMCwKICAgICAgICAgICAganVtcENvdW50OiAwLAogICAgICAgICAgICBpbnZpbmNpYmxlVGltZXI6IDAKICAgICAgICB9LAogICAgICAgIHBhcnRpY2xlczogW10sCiAgICAgICAgY2FtZXJhOiB7IHg6IDAsIHk6IDAgfSwKICAgICAgICBrZXlzOiB7fSwKICAgICAgICBwcmV2SnVtcFByZXNzZWQ6IGZhbHNlLAogICAgICAgIGxhc3RUaW1lOiAwLAogICAgICAgIGFjY3VtdWxhdG9yOiAwLAogICAgICAgIHNoYWtlOiAwLAogICAgICAgIGRhbWFnZVNoYWtlOiAwLAogICAgICAgIGJhY2tncm91bmRPZmZzZXQ6IDAsCiAgICAgICAgY3VycmVudE1heFNwZWVkOiBNQVhfU1BFRUQKICAgIH0pOwogICAgY29uc3QgcHJlcGFyZVRpbnRlZFNwcml0ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHsKICAgICAgICBpZiAoIXBsYXllckltYWdlLmN1cnJlbnQuY29tcGxldGUgfHwgcGxheWVySW1hZ2UuY3VycmVudC5uYXR1cmFsV2lkdGggPT09IDApCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAvLyBDcmVhdGUgb2Zmc2NyZWVuIGNhbnZhcyBmb3IgdGludGluZwogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gcGxheWVySW1hZ2UuY3VycmVudC53aWR0aDsKICAgICAgICBjLmhlaWdodCA9IHBsYXllckltYWdlLmN1cnJlbnQuaGVpZ2h0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBpZiAoIWN0eCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIC8vIERyYXcgb3JpZ2luYWwKICAgICAgICBjdHguZHJhd0ltYWdlKHBsYXllckltYWdlLmN1cnJlbnQsIDAsIDApOwogICAgICAgIC8vIElmIGNvbG9yIGlzIG5vdCB3aGl0ZSwgYXBwbHkgdGludAogICAgICAgIGlmIChzZXR0aW5ncy5wbGF5ZXJDb2xvciAhPT0gJyNmZmZmZmYnKSB7CiAgICAgICAgICAgIGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLWluJzsKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHNldHRpbmdzLnBsYXllckNvbG9yOwogICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgYy53aWR0aCwgYy5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICB0aW50ZWRQbGF5ZXJDYW52YXMuY3VycmVudCA9IGM7CiAgICB9LCBbc2V0dGluZ3MucGxheWVyQ29sb3JdKTsKICAgIC8vIExvYWQgQXNzZXRzIGFuZCBJbml0IEF1ZGlvCiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIHBsYXllckltYWdlLmN1cnJlbnQuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsKICAgICAgICBwbGF5ZXJJbWFnZS5jdXJyZW50LnNyYyA9IEZMT1VOREVSX0xPR09fVVJMOwogICAgICAgIHBsYXllckltYWdlLmN1cnJlbnQub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICBwcmVwYXJlVGludGVkU3ByaXRlKCk7CiAgICAgICAgICAgIHNldExvYWRpbmcoZmFsc2UpOwogICAgICAgIH07CiAgICAgICAgcGxheWVySW1hZ2UuY3VycmVudC5vbmVycm9yID0gKCkgPT4gc2V0TG9hZGluZyhmYWxzZSk7CiAgICAgICAgLy8gSW5pdCBBdWRpbwogICAgICAgIGF1ZGlvTWFuYWdlci5pbml0KCk7CiAgICAgICAgYXVkaW9NYW5hZ2VyLnNldFZvbHVtZShzZXR0aW5ncy5zZnhWb2x1bWUpOwogICAgICAgIHN0YXJ0TGV2ZWwoMSwgZmFsc2UpOwogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHMKICAgIH0sIFtdKTsKICAgIC8vIFVwZGF0ZSB0aW50IHdoZW4gY29sb3IgY2hhbmdlcwogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICBwcmVwYXJlVGludGVkU3ByaXRlKCk7CiAgICB9LCBbcHJlcGFyZVRpbnRlZFNwcml0ZV0pOwogICAgLy8gVXBkYXRlIFZvbHVtZSB3aGVuIHNldHRpbmdzIGNoYW5nZQogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICBhdWRpb01hbmFnZXIuc2V0Vm9sdW1lKHNldHRpbmdzLnNmeFZvbHVtZSk7CiAgICB9LCBbc2V0dGluZ3Muc2Z4Vm9sdW1lXSk7CiAgICAvLyBIYW5kbGUgUmVzaXplICYgSGlnaCBEUEkKICAgIGNvbnN0IGhhbmRsZVJlc2l6ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHsKICAgICAgICBpZiAoY2FudmFzUmVmLmN1cnJlbnQpIHsKICAgICAgICAgICAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsKICAgICAgICAgICAgY29uc3Qgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgICAgICBjYW52YXNSZWYuY3VycmVudC53aWR0aCA9IHdpZHRoICogZHByOwogICAgICAgICAgICBjYW52YXNSZWYuY3VycmVudC5oZWlnaHQgPSBoZWlnaHQgKiBkcHI7CiAgICAgICAgICAgIGNhbnZhc1JlZi5jdXJyZW50LnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgOwogICAgICAgICAgICBjYW52YXNSZWYuY3VycmVudC5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgOwogICAgICAgICAgICBjb25zdCBjdHggPSBjYW52YXNSZWYuY3VycmVudC5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICBpZiAoY3R4KSB7CiAgICAgICAgICAgICAgICBjdHgucmVzZXRUcmFuc2Zvcm0oKTsgLy8gQ2xlYXIgcHJldmlvdXMgdHJhbnNmb3JtcwogICAgICAgICAgICAgICAgY3R4LnNjYWxlKGRwciwgZHByKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sIFtdKTsKICAgIGNvbnN0IHJlc2V0Vmlld3BvcnQgPSB1c2VDYWxsYmFjaygoKSA9PiB7CiAgICAgICAgaGFuZGxlUmVzaXplKCk7CiAgICAgICAgY29uc29sZS5sb2coJ1tWaWV3cG9ydF0gUmVzZXQgZXhlY3V0ZWQnKTsKICAgIH0sIFtoYW5kbGVSZXNpemVdKTsKICAgIC8vIEZvcmNlIHJlc2l6ZSBvbiBnYW1lIG92ZXIgc3RhdGUgY2hhbmdlIG9yIG1vdW50CiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIGhhbmRsZVJlc2l6ZSgpOwogICAgICAgIC8vIERvdWJsZSB0YXAganVzdCBpbiBjYXNlCiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGhhbmRsZVJlc2l6ZSk7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGhhbmRsZVJlc2l6ZSk7CiAgICAgICAgcmV0dXJuICgpID0+IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBoYW5kbGVSZXNpemUpOwogICAgfSwgW2hhbmRsZVJlc2l6ZSwgZ2FtZU92ZXJdKTsKICAgIC8vIEZvY3VzIHRlcm1pbmFsIGlucHV0IHdoZW4gb3BlbmVkCiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIGlmIChzaG93VGVybWluYWwgJiYgdGVybWluYWxJbnB1dFJlZi5jdXJyZW50KSB7CiAgICAgICAgICAgIHRlcm1pbmFsSW5wdXRSZWYuY3VycmVudC5mb2N1cygpOwogICAgICAgIH0KICAgIH0sIFtzaG93VGVybWluYWxdKTsKICAgIGNvbnN0IHN0YXJ0TGV2ZWwgPSAoaWR4LCBwcmVzZXJ2ZUhlYWx0aCkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBnZW5lcmF0ZUxldmVsKGlkeCk7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQubGV2ZWwgPSBkYXRhOwogICAgICAgIC8vIEZ1bGwgUGxheWVyIFJlc2V0CiAgICAgICAgcmVzZXRQbGF5ZXJQb3NpdGlvbihkYXRhKTsKICAgICAgICAvLyBSZXNldCBpbnB1dHMKICAgICAgICBnYW1lU3RhdGUuY3VycmVudC5rZXlzID0ge307CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQucHJldkp1bXBQcmVzc2VkID0gZmFsc2U7CiAgICAgICAgLy8gUmVzZXQgU3BlZWQgQ29uc3RhbnRzCiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQuY3VycmVudE1heFNwZWVkID0gTUFYX1NQRUVEOwogICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LnBhcnRpY2xlcyA9IFtdOwogICAgICAgIHNldEdhbWVPdmVyKGZhbHNlKTsKICAgICAgICAvLyBIRUFMVEggTE9HSUM6IFByZXNlcnZlcyBhY3Jvc3MgbGV2ZWxzLCByZXNldHMgb24gZGVhdGgvcmVzdGFydAogICAgICAgIGlmICghcHJlc2VydmVIZWFsdGgpIHsKICAgICAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQucGxheWVyLmhlYWx0aCA9IDU7CiAgICAgICAgfQogICAgICAgIHNldEhlYWx0aChnYW1lU3RhdGUuY3VycmVudC5wbGF5ZXIuaGVhbHRoKTsgLy8gU3luYyBVSQogICAgICAgIHNldFBhdXNlZChmYWxzZSk7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQuc2hha2UgPSAwOwogICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmRhbWFnZVNoYWtlID0gMDsKICAgICAgICBnYW1lU3RhdGUuY3VycmVudC5wbGF5ZXIuaW52aW5jaWJsZVRpbWVyID0gMDsKICAgICAgICAvLyBTbmFwIGNhbWVyYSBpbW1lZGlhdGVseQogICAgICAgIGNvbnN0IHNjcmVlblcgPSB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgICBjb25zdCBzY3JlZW5IID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIGxldCBjYW1YID0gZGF0YS5zdGFydFBvcy54IC0gc2NyZWVuVyAvIDIgKyAyMDsKICAgICAgICBsZXQgY2FtWSA9IGRhdGEuc3RhcnRQb3MueSAtIHNjcmVlbkggLyAyOwogICAgICAgIGNhbVggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihjYW1YLCBkYXRhLndpZHRoIC0gc2NyZWVuVykpOwogICAgICAgIGNhbVkgPSBNYXRoLm1heCgtMjAwLCBNYXRoLm1pbihjYW1ZLCBkYXRhLmhlaWdodCAtIHNjcmVlbkggKyAyMDApKTsKICAgICAgICBjb25zb2xlLmxvZyhgW0NhbWVyYSBMb2ddIExldmVsICR7aWR4fSBTdGFydC4gUmVzZXR0aW5nIENhbWVyYSB0bzogeD0ke2NhbVgudG9GaXhlZCgyKX0sIHk9JHtjYW1ZLnRvRml4ZWQoMil9YCk7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQuY2FtZXJhLnggPSBjYW1YOwogICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmNhbWVyYS55ID0gY2FtWTsKICAgICAgICAvLyBSZXNldCB0aW1pbmcgbG9naWMKICAgICAgICBnYW1lU3RhdGUuY3VycmVudC5sYXN0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmFjY3VtdWxhdG9yID0gMDsKICAgIH07CiAgICBjb25zdCByZXNldFBsYXllclBvc2l0aW9uID0gKGxldmVsKSA9PiB7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQucGxheWVyLnggPSBsZXZlbC5zdGFydFBvcy54OwogICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LnBsYXllci55ID0gbGV2ZWwuc3RhcnRQb3MueTsKICAgICAgICBnYW1lU3RhdGUuY3VycmVudC5wbGF5ZXIudnggPSAwOwogICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LnBsYXllci52eSA9IDA7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQucGxheWVyLmp1bXBDb3VudCA9IDA7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQucGxheWVyLmludmluY2libGVUaW1lciA9IDA7CiAgICB9OwogICAgY29uc3QgaGFuZGxlUmVzdGFydCA9ICgpID0+IHsKICAgICAgICAvLyBFeHBsaWNpdGx5IHJ1biByZXNpemUgaW1tZWRpYXRlbHkKICAgICAgICBoYW5kbGVSZXNpemUoKTsKICAgICAgICAvLyBBbmQgb24gbmV4dCBmcmFtZSB0byBiZSBzdXJlCiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGhhbmRsZVJlc2l6ZSk7CiAgICAgICAgc2V0VGltZW91dChoYW5kbGVSZXNpemUsIDEwMCk7CiAgICAgICAgc3RhcnRMZXZlbChsZXZlbEluZGV4LCBmYWxzZSk7IC8vIEZhbHNlID0gcmVzZXQgaGVhbHRoIHRvIDUgb24gcmVzdGFydAogICAgfTsKICAgIGNvbnN0IGV4ZWN1dGVDb21tYW5kID0gKGlucHV0KSA9PiB7CiAgICAgICAgY29uc3QgcGFydHMgPSBpbnB1dC50cmltKCkuc3BsaXQoJyAnKTsKICAgICAgICBjb25zdCBjbWQgPSBwYXJ0c1swXS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGNvbnN0IGFyZ3MgPSBwYXJ0cy5zbGljZSgxKTsKICAgICAgICBzZXRUZXJtTG9nKHByZXYgPT4gWy4uLnByZXYsIGAkICR7aW5wdXR9YF0pOwogICAgICAgIGlmIChjbWQgPT09ICdsZXZlbC5zZXQnIHx8IGNtZCA9PT0gJ2xldmVsJykgewogICAgICAgICAgICBjb25zdCBsdmwgPSBwYXJzZUludChhcmdzWzBdKTsKICAgICAgICAgICAgaWYgKCFpc05hTihsdmwpICYmIGx2bCA+PSAxICYmIGx2bCA8PSBUT1RBTF9MRVZFTFMpIHsKICAgICAgICAgICAgICAgIHNldExldmVsSW5kZXgobHZsKTsKICAgICAgICAgICAgICAgIHN0YXJ0TGV2ZWwobHZsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzZXRUZXJtTG9nKHByZXYgPT4gWy4uLnByZXYsIGA+IExvYWRlZCBsZXZlbCAke2x2bH1gXSk7CiAgICAgICAgICAgICAgICBzZXRTaG93VGVybWluYWwoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgc2V0VGVybUxvZyhwcmV2ID0+IFsuLi5wcmV2LCBgPiBFcnJvcjogSW52YWxpZCBsZXZlbCAoMS0ke1RPVEFMX0xFVkVMU30pYF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gJ2hlYWwnKSB7CiAgICAgICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LnBsYXllci5oZWFsdGggPSA1OwogICAgICAgICAgICBzZXRIZWFsdGgoNSk7CiAgICAgICAgICAgIHNldFRlcm1Mb2cocHJldiA9PiBbLi4ucHJldiwgYD4gSGVhbHRoIHJlc3RvcmVkIHRvIDVgXSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gJ2NsZWFyJykgewogICAgICAgICAgICBzZXRUZXJtTG9nKFsnPiBDb25zb2xlIGNsZWFyZWQnXSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gJ3NwZWVkLnNldCcpIHsKICAgICAgICAgICAgY29uc3QgcyA9IHBhcnNlRmxvYXQoYXJnc1swXSk7CiAgICAgICAgICAgIGlmICghaXNOYU4ocykgJiYgcyA+IDApIHsKICAgICAgICAgICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmN1cnJlbnRNYXhTcGVlZCA9IHM7CiAgICAgICAgICAgICAgICBzZXRUZXJtTG9nKHByZXYgPT4gWy4uLnByZXYsIGA+IE1heCBzcGVlZCBzZXQgdG8gJHtzfWBdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHNldFRlcm1Mb2cocHJldiA9PiBbLi4ucHJldiwgYD4gRXJyb3I6IEludmFsaWQgc3BlZWRgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoY21kID09PSAnc3BlZWQubGlzdCcgfHwgY21kID09PSAnc3BlZWQnKSB7CiAgICAgICAgICAgIHNldFRlcm1Mb2cocHJldiA9PiBbLi4ucHJldiwgYD4gQ3VycmVudCBNYXg6ICR7Z2FtZVN0YXRlLmN1cnJlbnQuY3VycmVudE1heFNwZWVkfWBdKTsKICAgICAgICAgICAgc2V0VGVybUxvZyhwcmV2ID0+IFsuLi5wcmV2LCBgPiBQbGF5ZXIgVlg6ICR7Z2FtZVN0YXRlLmN1cnJlbnQucGxheWVyLnZ4LnRvRml4ZWQoMil9YF0pOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChjbWQgPT09ICd2aWV3cG9ydC5yZXNldCcpIHsKICAgICAgICAgICAgcmVzZXRWaWV3cG9ydCgpOwogICAgICAgICAgICBzZXRUZXJtTG9nKHByZXYgPT4gWy4uLnByZXYsIGA+IFZpZXdwb3J0IHJlc2V0IHRyaWdnZXJlZC5gXSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gJ2hlbHAnKSB7CiAgICAgICAgICAgIHNldFRlcm1Mb2cocHJldiA9PiBbLi4ucHJldiwgYD4gQ29tbWFuZHM6IGxldmVsLnNldCA8bj4sIGhlYWwsIHNwZWVkLnNldCA8bj4sIHNwZWVkLmxpc3QsIHZpZXdwb3J0LnJlc2V0LCBjbGVhcmBdKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHNldFRlcm1Mb2cocHJldiA9PiBbLi4ucHJldiwgYD4gVW5rbm93biBjb21tYW5kOiAke2NtZH1gXSk7CiAgICAgICAgfQogICAgICAgIHNldFRlcm1JbnB1dCgnJyk7CiAgICB9OwogICAgY29uc3QgY3JlYXRlUGFydGljbGUgPSAoeCwgeSwgY29sb3IsIHNwZWVkID0gMiwgc2l6ZSA9IDMsIGNvdW50ID0gMSkgPT4gewogICAgICAgIGlmICghc2V0dGluZ3MucGFydGljbGVzKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LnBhcnRpY2xlcy5wdXNoKHsKICAgICAgICAgICAgICAgIHgsIHksCiAgICAgICAgICAgICAgICB2eDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3BlZWQsCiAgICAgICAgICAgICAgICB2eTogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3BlZWQsCiAgICAgICAgICAgICAgICBsaWZlOiAxLjAsCiAgICAgICAgICAgICAgICBtYXhMaWZlOiAxLjAsCiAgICAgICAgICAgICAgICBzaXplOiBNYXRoLnJhbmRvbSgpICogc2l6ZSArIDEsCiAgICAgICAgICAgICAgICBjb2xvciwKICAgICAgICAgICAgICAgIGRlY2F5OiAwLjAyICsgTWF0aC5yYW5kb20oKSAqIDAuMDMKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIGNvbnN0IHNwYXduUHJvamVjdGlsZSA9ICh4LCB5LCB2eCwgdnksIGlzQm9zcyA9IGZhbHNlKSA9PiB7CiAgICAgICAgaWYgKCFnYW1lU3RhdGUuY3VycmVudC5sZXZlbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICghaXNCb3NzKQogICAgICAgICAgICBhdWRpb01hbmFnZXIucGxheVNob290KCk7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQubGV2ZWwucHJvamVjdGlsZXMucHVzaCh7CiAgICAgICAgICAgIGlkOiBgcHJvai0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKX1gLAogICAgICAgICAgICB0eXBlOiBFbnRpdHlUeXBlLlBST0pFQ1RJTEUsCiAgICAgICAgICAgIHgsIHksIHc6IGlzQm9zcyA/IDIwIDogMTUsIGg6IGlzQm9zcyA/IDIwIDogMTUsCiAgICAgICAgICAgIHZ4LCB2eSwKICAgICAgICAgICAgY29sb3I6IGlzQm9zcyA/ICcjZWY0NDQ0JyA6ICcjZmJiZjI0JywKICAgICAgICAgICAgaGVhbHRoOiAxLCBtYXhIZWFsdGg6IDEsCiAgICAgICAgICAgIGlzR3JvdW5kZWQ6IGZhbHNlLCBmYWNpbmdSaWdodDogdnggPiAwLCBzdGF0ZTogJ2lkbGUnLCBmcmFtZVRpbWVyOiAwLCBqdW1wQ291bnQ6IDAsIGludmluY2libGVUaW1lcjogMAogICAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IHVwZGF0ZSA9IChkdCkgPT4gewogICAgICAgIC8vIE5PVEU6IGR0IGlzIGVmZmVjdGl2ZWx5IGNvbnN0YW50IDEuMCBpbiBmaXhlZCB0aW1lc3RlcCBsb29wCiAgICAgICAgaWYgKHBhdXNlZCB8fCBnYW1lT3ZlciB8fCBzaG93VGVybWluYWwgfHwgIWdhbWVTdGF0ZS5jdXJyZW50LmxldmVsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3Qgc3RhdGUgPSBnYW1lU3RhdGUuY3VycmVudDsKICAgICAgICBjb25zdCB7IHBsYXllciwga2V5cywgbGV2ZWwgfSA9IHN0YXRlOwogICAgICAgIC8vIEludmluY2liaWxpdHkgVGltZXIKICAgICAgICBpZiAocGxheWVyLmludmluY2libGVUaW1lciA+IDApIHsKICAgICAgICAgICAgcGxheWVyLmludmluY2libGVUaW1lciAtPSAoZHQgKiAwLjAxNjY3KTsgLy8gQXBwcm94IHNlY29uZHMKICAgICAgICB9CiAgICAgICAgLy8gLS0tIFBsYXllciBNb3ZlbWVudCAtLS0KICAgICAgICBpZiAoa2V5c1snQXJyb3dSaWdodCddIHx8IGtleXNbJ2QnXSkgewogICAgICAgICAgICBwbGF5ZXIudnggKz0gTU9WRV9TUEVFRCAqIGR0OwogICAgICAgICAgICBwbGF5ZXIuZmFjaW5nUmlnaHQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoa2V5c1snQXJyb3dMZWZ0J10gfHwga2V5c1snYSddKSB7CiAgICAgICAgICAgIHBsYXllci52eCAtPSBNT1ZFX1NQRUVEICogZHQ7CiAgICAgICAgICAgIHBsYXllci5mYWNpbmdSaWdodCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBwbGF5ZXIudnggKj0gRlJJQ1RJT047IC8vIEZyaWN0aW9uIGlzIGEgZGFtcGVuZXIsIHdvcmtzIHBlciBmcmFtZQogICAgICAgIHBsYXllci52eSArPSBHUkFWSVRZICogZHQ7CiAgICAgICAgcGxheWVyLnZ4ID0gTWF0aC5tYXgoTWF0aC5taW4ocGxheWVyLnZ4LCBzdGF0ZS5jdXJyZW50TWF4U3BlZWQpLCAtc3RhdGUuY3VycmVudE1heFNwZWVkKTsKICAgICAgICAvLyBEb3VibGUgSnVtcAogICAgICAgIGNvbnN0IGp1bXBQcmVzc2VkID0ga2V5c1snQXJyb3dVcCddIHx8IGtleXNbJ3cnXSB8fCBrZXlzWycgJ107CiAgICAgICAgaWYgKHBsYXllci5pc0dyb3VuZGVkKQogICAgICAgICAgICBwbGF5ZXIuanVtcENvdW50ID0gMDsKICAgICAgICBpZiAoanVtcFByZXNzZWQgJiYgIXN0YXRlLnByZXZKdW1wUHJlc3NlZCkgewogICAgICAgICAgICBpZiAocGxheWVyLmlzR3JvdW5kZWQgfHwgcGxheWVyLmp1bXBDb3VudCA8IDIpIHsKICAgICAgICAgICAgICAgIHBsYXllci52eSA9IEpVTVBfRk9SQ0U7CiAgICAgICAgICAgICAgICBwbGF5ZXIuaXNHcm91bmRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcGxheWVyLmp1bXBDb3VudCsrOwogICAgICAgICAgICAgICAgYXVkaW9NYW5hZ2VyLnBsYXlKdW1wKCk7IC8vIFNPVU5ECiAgICAgICAgICAgICAgICBpZiAocGxheWVyLmp1bXBDb3VudCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgIGNyZWF0ZVBhcnRpY2xlKHBsYXllci54ICsgcGxheWVyLncgLyAyLCBwbGF5ZXIueSArIHBsYXllci5oLCBsZXZlbC50aGVtZS5hY2NlbnRDb2xvciwgOCwgNCwgMTApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUGFydGljbGUocGxheWVyLnggKyBwbGF5ZXIudyAvIDIsIHBsYXllci55ICsgcGxheWVyLmgsICcjZmZmJywgNSwgNSwgNSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RhdGUucHJldkp1bXBQcmVzc2VkID0ganVtcFByZXNzZWQ7CiAgICAgICAgcGxheWVyLnggKz0gcGxheWVyLnZ4ICogZHQ7CiAgICAgICAgcGxheWVyLnkgKz0gcGxheWVyLnZ5ICogZHQ7CiAgICAgICAgLy8gLS0tIENvbGxpc2lvbiBEZXRlY3Rpb24gLS0tCiAgICAgICAgcGxheWVyLmlzR3JvdW5kZWQgPSBmYWxzZTsKICAgICAgICBsZXZlbC5wbGF0Zm9ybXMuZm9yRWFjaChwbGF0ID0+IHsKICAgICAgICAgICAgY29uc3QgeE92ZXJsYXAgPSBwbGF5ZXIueCA8IHBsYXQueCArIHBsYXQudyArIDEwMCAmJiBwbGF5ZXIueCArIHBsYXllci53ID4gcGxhdC54IC0gMTAwOwogICAgICAgICAgICBjb25zdCB5RGlzdCA9IE1hdGguYWJzKHBsYXllci55IC0gcGxhdC55KTsKICAgICAgICAgICAgaWYgKHhPdmVybGFwICYmIHlEaXN0IDwgMTAwMCkKICAgICAgICAgICAgICAgIHJlc29sdmVDb2xsaXNpb24ocGxheWVyLCBwbGF0KTsKICAgICAgICB9KTsKICAgICAgICBpZiAocGxheWVyLnkgPiAyMDAwKSB7CiAgICAgICAgICAgIHBsYXllci5oZWFsdGggPSAwOwogICAgICAgICAgICBzZXRIZWFsdGgoMCk7CiAgICAgICAgICAgIHN0YXRlLnNoYWtlID0gMjA7IC8vIEZhbGxpbmcgdG8gZGVhdGggaXMgaW5zdGFudCwgaWdub3JlcyBpbnZpbmNpYmlsaXR5CiAgICAgICAgICAgIGF1ZGlvTWFuYWdlci5wbGF5RGFtYWdlKCk7IC8vIFNPVU5ECiAgICAgICAgfQogICAgICAgIC8vIC0tLSBDb2xsZWN0aWJsZXMgKEhlYWx0aCBQb3dlci1VcHMpIC0tLQogICAgICAgIGZvciAobGV0IGkgPSBsZXZlbC5jb2xsZWN0aWJsZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgY29uc3QgYyA9IGxldmVsLmNvbGxlY3RpYmxlc1tpXTsKICAgICAgICAgICAgYy5mcmFtZVRpbWVyICs9IDAuMDUgKiBkdDsKICAgICAgICAgICAgYy55ICs9IE1hdGguc2luKGMuZnJhbWVUaW1lcikgKiAwLjMgKiBkdDsKICAgICAgICAgICAgaWYgKGNoZWNrQUFCQihwbGF5ZXIsIGMpKSB7CiAgICAgICAgICAgICAgICBjcmVhdGVQYXJ0aWNsZShjLnggKyBjLncgLyAyLCBjLnkgKyBjLmggLyAyLCBjLmNvbG9yLCA2LCA0LCAxMik7CiAgICAgICAgICAgICAgICAvLyBGaXg6IFVzZSBnYW1lU3RhdGUgcGxheWVyIGhlYWx0aCBzb3VyY2Ugb2YgdHJ1dGgKICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuaGVhbHRoIDwgNSkgewogICAgICAgICAgICAgICAgICAgIHBsYXllci5oZWFsdGggPSBNYXRoLm1pbihwbGF5ZXIuaGVhbHRoICsgMSwgNSk7CiAgICAgICAgICAgICAgICAgICAgc2V0SGVhbHRoKHBsYXllci5oZWFsdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXVkaW9NYW5hZ2VyLnBsYXlDb2xsZWN0KCk7IC8vIFNPVU5ECiAgICAgICAgICAgICAgICBsZXZlbC5jb2xsZWN0aWJsZXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBFbmVtaWVzIC0tLQogICAgICAgIGZvciAobGV0IGkgPSBsZXZlbC5lbmVtaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIGNvbnN0IGVuZW15ID0gbGV2ZWwuZW5lbWllc1tpXTsKICAgICAgICAgICAgaWYgKGVuZW15LnN1YnR5cGUgPT09ICdmbHllcicpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gcGxheWVyLnggLSBlbmVteS54OwogICAgICAgICAgICAgICAgY29uc3QgZHkgPSBwbGF5ZXIueSAtIGVuZW15Lnk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgNjAwKSB7CiAgICAgICAgICAgICAgICAgICAgZW5lbXkudnggKz0gKGR4IC8gZGlzdCkgKiAwLjIgKiBkdDsKICAgICAgICAgICAgICAgICAgICBlbmVteS52eSArPSAoZHkgLyBkaXN0KSAqIDAuMiAqIGR0OwogICAgICAgICAgICAgICAgICAgIGVuZW15LnZ4ICo9IDAuOTU7CiAgICAgICAgICAgICAgICAgICAgZW5lbXkudnkgKj0gMC45NTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVuZW15LnggKz0gZW5lbXkudnggKiBkdDsKICAgICAgICAgICAgICAgIGVuZW15LnkgKz0gZW5lbXkudnkgKiBkdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChlbmVteS5zdWJ0eXBlID09PSAndHVycmV0JykgewogICAgICAgICAgICAgICAgZW5lbXkuZnJhbWVUaW1lciArPSBkdDsKICAgICAgICAgICAgICAgIGlmIChlbmVteS5mcmFtZVRpbWVyID4gMTUwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHggPSBwbGF5ZXIueCAtIGVuZW15Lng7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSBwbGF5ZXIueSAtIGVuZW15Lnk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QgPCA4MDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd25Qcm9qZWN0aWxlKGVuZW15LnggKyBlbmVteS53IC8gMiwgZW5lbXkueSArIGVuZW15LmggLyAyLCAoZHggLyBkaXN0KSAqIDgsIChkeSAvIGRpc3QpICogOCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVuZW15LmZyYW1lVGltZXIgPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gUGF0cm9sbGVyCiAgICAgICAgICAgICAgICBpZiAoIWVuZW15LnZ4KQogICAgICAgICAgICAgICAgICAgIGVuZW15LnZ4ID0gMjsKICAgICAgICAgICAgICAgIGVuZW15LnggKz0gZW5lbXkudnggKiBkdDsKICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wMSkKICAgICAgICAgICAgICAgICAgICBlbmVteS52eCAqPSAtMTsKICAgICAgICAgICAgICAgIGVuZW15LnZ5ICs9IEdSQVZJVFkgKiBkdDsKICAgICAgICAgICAgICAgIGVuZW15LnkgKz0gZW5lbXkudnkgKiBkdDsKICAgICAgICAgICAgICAgIGxldmVsLnBsYXRmb3Jtcy5mb3JFYWNoKHBsYXQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhlbmVteS54IC0gcGxhdC54KSA8IDUwMCAmJiBNYXRoLmFicyhlbmVteS55IC0gcGxhdC55KSA8IDUwMCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZUNvbGxpc2lvbihlbmVteSwgcGxhdCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbmVteS5mYWNpbmdSaWdodCA9IGVuZW15LnZ4ID4gMDsKICAgICAgICAgICAgaWYgKGNoZWNrQUFCQihwbGF5ZXIsIGVuZW15KSkgewogICAgICAgICAgICAgICAgaWYgKHBsYXllci52eSA+IDAgJiYgcGxheWVyLnkgKyBwbGF5ZXIuaCA8IGVuZW15LnkgKyBlbmVteS5oICogMC44KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGxheWVyIGtpbGxzIGVuZW15IChTdG9tcCkKICAgICAgICAgICAgICAgICAgICBjcmVhdGVQYXJ0aWNsZShlbmVteS54ICsgZW5lbXkudyAvIDIsIGVuZW15LnkgKyBlbmVteS5oIC8gMiwgZW5lbXkuY29sb3IsIDgsIDgsIDEyKTsKICAgICAgICAgICAgICAgICAgICBsZXZlbC5lbmVtaWVzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIudnkgPSAtMTI7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmp1bXBDb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc2hha2UgPSAzOwogICAgICAgICAgICAgICAgICAgIGF1ZGlvTWFuYWdlci5wbGF5RW5lbXlEZWF0aCgpOyAvLyBTT1VORAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRW5lbXkgaGl0cyBwbGF5ZXIKICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLmludmluY2libGVUaW1lciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJFU0VUIFNQRUVEIG9uIGRhbWFnZSB0byBiYXNlICgwKSBzbyB0aGV5IGNhbiBhY2NlbGVyYXRlIGFnYWluCiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci52eCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci52eSA9IC01OyAvLyBTbGlnaHQgcG9wIHVwCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRvIGJhc2UgbGV2ZWwgMSBzcGVlZCBjb25zdGFudAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jdXJyZW50TWF4U3BlZWQgPSBNQVhfU1BFRUQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5oZWFsdGggLT0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0SGVhbHRoKHBsYXllci5oZWFsdGgpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5kYW1hZ2VTaGFrZSA9IDEwOwogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVQYXJ0aWNsZShwbGF5ZXIueCwgcGxheWVyLnksICcjZmZmJywgNSwgMiwgNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgSW52aW5jaWJpbGl0eSAoMiBzZWNvbmRzKQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuaW52aW5jaWJsZVRpbWVyID0gMi4wOwogICAgICAgICAgICAgICAgICAgICAgICBhdWRpb01hbmFnZXIucGxheURhbWFnZSgpOyAvLyBTT1VORAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyAtLS0gUHJvamVjdGlsZXMgLS0tCiAgICAgICAgZm9yIChsZXQgaSA9IGxldmVsLnByb2plY3RpbGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIGNvbnN0IHAgPSBsZXZlbC5wcm9qZWN0aWxlc1tpXTsKICAgICAgICAgICAgcC54ICs9IHAudnggKiBkdDsKICAgICAgICAgICAgcC55ICs9IHAudnkgKiBkdDsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKHAueCAtIHBsYXllci54KSA+IDE1MDApIHsKICAgICAgICAgICAgICAgIGxldmVsLnByb2plY3RpbGVzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaGVja0FBQkIocCwgcGxheWVyKSkgewogICAgICAgICAgICAgICAgaWYgKHBsYXllci5pbnZpbmNpYmxlVGltZXIgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJFU0VUIFNQRUVECiAgICAgICAgICAgICAgICAgICAgcGxheWVyLnZ4ID0gMDsKICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCB0byBiYXNlIGxldmVsIDEgc3BlZWQgY29uc3RhbnQKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jdXJyZW50TWF4U3BlZWQgPSBNQVhfU1BFRUQ7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmhlYWx0aCAtPSAxOwogICAgICAgICAgICAgICAgICAgIHNldEhlYWx0aChwbGF5ZXIuaGVhbHRoKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5kYW1hZ2VTaGFrZSA9IDg7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUGFydGljbGUocGxheWVyLngsIHBsYXllci55LCBsZXZlbC50aGVtZS5oYXphcmRDb2xvciwgNSwgMywgOCk7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmludmluY2libGVUaW1lciA9IDIuMDsgLy8gSW52aW5jaWJpbGl0eSBvbiBwcm9qZWN0aWxlIGhpdAogICAgICAgICAgICAgICAgICAgIGF1ZGlvTWFuYWdlci5wbGF5RGFtYWdlKCk7IC8vIFNPVU5ECiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZXZlbC5wcm9qZWN0aWxlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgaGl0ID0gZmFsc2U7CiAgICAgICAgICAgIGxldmVsLnBsYXRmb3Jtcy5mb3JFYWNoKHBsYXQgPT4gewogICAgICAgICAgICAgICAgaWYgKGNoZWNrQUFCQihwLCBwbGF0KSkKICAgICAgICAgICAgICAgICAgICBoaXQgPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGhpdCkgewogICAgICAgICAgICAgICAgY3JlYXRlUGFydGljbGUocC54LCBwLnksIHAuY29sb3IsIDMsIDIsIDQpOwogICAgICAgICAgICAgICAgbGV2ZWwucHJvamVjdGlsZXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBCb3NzIExvZ2ljIChVcGRhdGVkIGZvciBCb3NzIDIgRGlmZmVyZW50aWF0aW9uKSAtLS0KICAgICAgICBpZiAobGV2ZWwuYm9zcyAmJiBsZXZlbC5ib3NzLmhlYWx0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYm9zcyA9IGxldmVsLmJvc3M7CiAgICAgICAgICAgIGNvbnN0IGlzQm9zczIgPSBsZXZlbC5pZCA9PT0gMTI7CiAgICAgICAgICAgIGNvbnN0IGhwUGVyY2VudCA9IGJvc3MuaGVhbHRoIC8gYm9zcy5tYXhIZWFsdGg7CiAgICAgICAgICAgIC8vIDEuIERldGVybWluZSBQaGFzZQogICAgICAgICAgICBpZiAoaHBQZXJjZW50ID4gMC42KQogICAgICAgICAgICAgICAgYm9zcy5waGFzZSA9IDE7CiAgICAgICAgICAgIGVsc2UgaWYgKGhwUGVyY2VudCA+IDAuMykKICAgICAgICAgICAgICAgIGJvc3MucGhhc2UgPSAyOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBib3NzLnBoYXNlID0gMzsKICAgICAgICAgICAgYm9zcy5hdHRhY2tUaW1lciA9IChib3NzLmF0dGFja1RpbWVyIHx8IDApICsgZHQ7CiAgICAgICAgICAgIGlmIChib3NzLnRpcmVkVGltZXIgJiYgYm9zcy50aXJlZFRpbWVyID4gMCkKICAgICAgICAgICAgICAgIGJvc3MudGlyZWRUaW1lciAtPSAoZHQgKiAwLjAxNik7CiAgICAgICAgICAgIGNvbnN0IGR4ID0gcGxheWVyLnggLSBib3NzLng7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gcGxheWVyLnkgLSBib3NzLnk7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICAgICAgICBjb25zdCBpc1RpcmVkID0gYm9zcy50aXJlZFRpbWVyICYmIGJvc3MudGlyZWRUaW1lciA+IDA7CiAgICAgICAgICAgIC8vIEhhbmRsZSBUaXJlZCBQaHlzaWNzCiAgICAgICAgICAgIGlmIChpc1RpcmVkKSB7CiAgICAgICAgICAgICAgICBib3NzLnZ4ICo9IDAuODsKICAgICAgICAgICAgICAgIGJvc3MudnkgKz0gR1JBVklUWSAqIGR0OwogICAgICAgICAgICAgICAgLy8gRmxvb3IgY29sbGlzaW9uCiAgICAgICAgICAgICAgICBpZiAoYm9zcy55ICsgYm9zcy5oID49IGxldmVsLmhlaWdodCAtIDE1MCkgewogICAgICAgICAgICAgICAgICAgIGJvc3MueSA9IGxldmVsLmhlaWdodCAtIDE1MCAtIGJvc3MuaDsKICAgICAgICAgICAgICAgICAgICBib3NzLnZ5ID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJvc3MueCArPSBib3NzLnZ4ICogZHQ7CiAgICAgICAgICAgICAgICBib3NzLnkgKz0gYm9zcy52eSAqIGR0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gU3RhbmRhcmQgUGhhc2VzCiAgICAgICAgICAgICAgICBpZiAoYm9zcy5waGFzZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIC8vIEhvdmVyIGFuZCBTaG9vdAogICAgICAgICAgICAgICAgICAgIGJvc3MudGFyZ2V0WCA9IHBsYXllci54OwogICAgICAgICAgICAgICAgICAgIGJvc3MudGFyZ2V0WSA9IHBsYXllci55IC0gMjAwOyAvLyBIb3ZlciBhYm92ZQogICAgICAgICAgICAgICAgICAgIC8vIFNtb290aCBsZXJwIHRvIGhvdmVyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgYm9zcy54ICs9IChib3NzLnRhcmdldFggLSBib3NzLngpICogMC4wMyAqIGR0OwogICAgICAgICAgICAgICAgICAgIGJvc3MueSArPSAoYm9zcy50YXJnZXRZIC0gYm9zcy55KSAqIDAuMDMgKiBkdDsKICAgICAgICAgICAgICAgICAgICAvLyBTaG9vdAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcmVSYXRlID0gaXNCb3NzMiA/IDkwIDogMTIwOyAvLyBCb3NzIDIgc2hvb3RzIGZhc3RlcgogICAgICAgICAgICAgICAgICAgIGlmIChib3NzLmF0dGFja1RpbWVyID4gZmlyZVJhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduUHJvamVjdGlsZShib3NzLnggKyBib3NzLncgLyAyLCBib3NzLnkgKyBib3NzLmggLyAyLCBNYXRoLmNvcyhhbmdsZSkgKiA3LCBNYXRoLnNpbihhbmdsZSkgKiA3LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQm9zczIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhIHByb2plY3RpbGVzIGZvciBCb3NzIDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduUHJvamVjdGlsZShib3NzLnggKyBib3NzLncgLyAyLCBib3NzLnkgKyBib3NzLmggLyAyLCBNYXRoLmNvcyhhbmdsZSArIDAuMykgKiA3LCBNYXRoLnNpbihhbmdsZSArIDAuMykgKiA3LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduUHJvamVjdGlsZShib3NzLnggKyBib3NzLncgLyAyLCBib3NzLnkgKyBib3NzLmggLyAyLCBNYXRoLmNvcyhhbmdsZSAtIDAuMykgKiA3LCBNYXRoLnNpbihhbmdsZSAtIDAuMykgKiA3LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBib3NzLmF0dGFja1RpbWVyID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW9NYW5hZ2VyLnBsYXlTaG9vdCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJvc3MucGhhc2UgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBCb3NzIDI6IFRyaWFuZ2xlIEFpbSAmIENoYXJnZSBNZWNoYW5pYwogICAgICAgICAgICAgICAgICAgIGlmIChpc0Jvc3MyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYm9zcy5kYXNoU3RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLmRhc2hTdGF0ZSA9ICdhaW1pbmcnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9zcy5kYXNoU3RhdGUgPT09ICdhaW1pbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIb3ZlciBoaWdoIGFuZCBmb2xsb3cgWAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaG92ZXJZID0gbGV2ZWwuaGVpZ2h0IC0gNDAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy54ICs9IChwbGF5ZXIueCAtIGJvc3MueCkgKiAwLjA1ICogZHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLnkgKz0gKGhvdmVyWSAtIGJvc3MueSkgKiAwLjA1ICogZHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9zcy5hdHRhY2tUaW1lciA+IDEyMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MuZGFzaFN0YXRlID0gJ2xvY2tpbmcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MuYXR0YWNrVGltZXIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBUYXJnZXQgZm9yIHZpc3VhbCBsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy50YXJnZXRYID0gcGxheWVyLng7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy50YXJnZXRZID0gcGxheWVyLnk7IC8vIEFpbSBhdCBjdXJyZW50IHBsYXllciBwb3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpb01hbmFnZXIucGxheUNvbGxlY3QoKTsgLy8gV2FybmluZyBzb3VuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJvc3MuZGFzaFN0YXRlID09PSAnbG9ja2luZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZyZWV6ZSBhbmQgdGVsZWdyYXBoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9zcy5hdHRhY2tUaW1lciA+IDQwKSB7IC8vIDAuNnMgd2FybmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MuZGFzaFN0YXRlID0gJ2Rhc2hpbmcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBjaGFyZ2UgdmVjdG9yIHRvd2FyZHMgdGFyZ2V0IChleHRlbmRlZCB0byBmbG9vcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0eCA9IGJvc3MudGFyZ2V0WCB8fCBwbGF5ZXIueDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0eSA9IGJvc3MudGFyZ2V0WSB8fCBwbGF5ZXIueTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhZHggPSB0eCAtIGJvc3MueDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhZHkgPSB0eSAtIGJvc3MueTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmcgPSBNYXRoLmF0YW4yKGFkeSwgYWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLnZ4ID0gTWF0aC5jb3MoYW5nKSAqIDIwOyAvLyBGYXN0IGNoYXJnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MudnkgPSBNYXRoLnNpbihhbmcpICogMjA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy5hdHRhY2tUaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW9NYW5hZ2VyLnBsYXlKdW1wKCk7IC8vIERhc2ggc291bmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChib3NzLmRhc2hTdGF0ZSA9PT0gJ2Rhc2hpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLnggKz0gYm9zcy52eCAqIGR0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy55ICs9IGJvc3MudnkgKiBkdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVBhcnRpY2xlKGJvc3MueCArIGJvc3MudyAvIDIsIGJvc3MueSArIGJvc3MuaCAvIDIsICcjYTg1NWY3JywgMywgNSwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBoaXRzIHdhbGwgb3IgZmxvb3IsIGJlY29tZSB0aXJlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGl0Rmxvb3IgPSBib3NzLnkgKyBib3NzLmggPj0gbGV2ZWwuaGVpZ2h0IC0gMTUwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGl0V2FsbCA9IGJvc3MueCA8PSAwIHx8IGJvc3MueCArIGJvc3MudyA+PSBsZXZlbC53aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaXRGbG9vciB8fCBoaXRXYWxsIHx8IGJvc3MuYXR0YWNrVGltZXIgPiA2MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MuZGFzaFN0YXRlID0gJ3RpcmVkJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLnRpcmVkVGltZXIgPSAzLjA7IC8vIFRpcmVkIGZvciAzIHNlY29uZHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLmF0dGFja1RpbWVyID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChib3NzLmRhc2hTdGF0ZSA9PT0gJ3RpcmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9naWMgaGFuZGxlZCBhdCB0b3Agb2YgQm9zcyBibG9jayAoaXNUaXJlZCBjaGVjaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1c3Qgd2FpdCBmb3IgdGltZXIgdG8gZXhwaXJlIHRvIHJlc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9zcy50aXJlZFRpbWVyICYmIGJvc3MudGlyZWRUaW1lciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy5kYXNoU3RhdGUgPSAnYWltaW5nJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLmF0dGFja1RpbWVyID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9zcyAxIFNpbXBsZSBEYXNoCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChib3NzLmF0dGFja1RpbWVyID4gMTUwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9zcy5hdHRhY2tUaW1lciA8IDE4MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYm9zcy52eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy52eCA9IE1hdGguY29zKGFuZ2xlKSAqIDE1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3NzLnZ5ID0gTWF0aC5zaW4oYW5nbGUpICogMTU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MueCArPSBib3NzLnZ4ICogZHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy55ICs9IGJvc3MudnkgKiBkdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MudnggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MudnkgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvc3MuYXR0YWNrVGltZXIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGhhc2UgMzogRW5yYWdlZAogICAgICAgICAgICAgICAgICAgIC8vIFJhcGlkIG1vdmVtZW50IHRvd2FyZHMgcGxheWVyCiAgICAgICAgICAgICAgICAgICAgYm9zcy54ICs9IGR4ICogMC4wNCAqIGR0OwogICAgICAgICAgICAgICAgICAgIGJvc3MueSArPSBkeSAqIDAuMDQgKiBkdDsKICAgICAgICAgICAgICAgICAgICAvLyBQZXJpb2RpYyBidXJzdCBmaXJlCiAgICAgICAgICAgICAgICAgICAgaWYgKGJvc3MuYXR0YWNrVGltZXIgPiA2MCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaG90cyA9IGlzQm9zczIgPyA4IDogNDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaG90czsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gKE1hdGguUEkgKiAyIC8gc2hvdHMpICogaSArIChEYXRlLm5vdygpIC8gNTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduUHJvamVjdGlsZShib3NzLnggKyBib3NzLncgLyAyLCBib3NzLnkgKyBib3NzLmggLyAyLCBNYXRoLmNvcyhhKSAqIDYsIE1hdGguc2luKGEpICogNiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYm9zcy5hdHRhY2tUaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvTWFuYWdlci5wbGF5U2hvb3QoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQm9zcyBjb2xsaXNpb24gd2l0aCBwbGF5ZXIKICAgICAgICAgICAgaWYgKGNoZWNrQUFCQihwbGF5ZXIsIGJvc3MpKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBwbGF5ZXIganVtcHMgb24gaGVhZCBPUiBib3NzIGlzIHRpcmVkICh2dWxuZXJhYmxlKQogICAgICAgICAgICAgICAgY29uc3QgaGVhZEhpdCA9IHBsYXllci52eSA+IDAgJiYgcGxheWVyLnkgKyBwbGF5ZXIuaCA8IGJvc3MueSArIGJvc3MuaCAqIDAuNTsKICAgICAgICAgICAgICAgIGlmIChoZWFkSGl0IHx8IGlzVGlyZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBQbGF5ZXIgSGl0IEJvc3MKICAgICAgICAgICAgICAgICAgICBib3NzLmhlYWx0aC0tOwogICAgICAgICAgICAgICAgICAgIHBsYXllci52eSA9IC0xMjsKICAgICAgICAgICAgICAgICAgICBjcmVhdGVQYXJ0aWNsZShib3NzLnggKyBib3NzLncgLyAyLCBib3NzLnksIGJvc3MuY29sb3IsIDEwLCAxMCwgMTUpOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnNoYWtlID0gNTsKICAgICAgICAgICAgICAgICAgICBhdWRpb01hbmFnZXIucGxheUVuZW15RGVhdGgoKTsKICAgICAgICAgICAgICAgICAgICAvLyBLbm9ja2JhY2sgYm9zcyBzbGlnaHRseQogICAgICAgICAgICAgICAgICAgIGJvc3MueSArPSAxMDsKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aXJlZCwgd2FrZSB1cCBpZiBoaXQ/IE5vLCBsZXQgcGxheWVyIGNvbWJvLgogICAgICAgICAgICAgICAgICAgIHBsYXllci5pbnZpbmNpYmxlVGltZXIgPSAwLjU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLmludmluY2libGVUaW1lciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvc3MgSGl0IFBsYXllcgogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIudnggPSAtTWF0aC5zaWduKGR4KSAqIDEwOwogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIudnkgPSAtNTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY3VycmVudE1heFNwZWVkID0gTUFYX1NQRUVEOyAvLyBSZXNldCBzcGVlZCBjYXAKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmhlYWx0aCAtPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRIZWFsdGgocGxheWVyLmhlYWx0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmRhbWFnZVNoYWtlID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5pbnZpbmNpYmxlVGltZXIgPSAyLjA7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvTWFuYWdlci5wbGF5RGFtYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBQYXJ0aWNsZXMgLS0tCiAgICAgICAgZm9yIChsZXQgaSA9IHN0YXRlLnBhcnRpY2xlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICBjb25zdCBwID0gc3RhdGUucGFydGljbGVzW2ldOwogICAgICAgICAgICBwLnggKz0gcC52eCAqIGR0OwogICAgICAgICAgICBwLnkgKz0gcC52eSAqIGR0OwogICAgICAgICAgICBwLmxpZmUgLT0gcC5kZWNheSAqIGR0OwogICAgICAgICAgICBpZiAocC5saWZlIDw9IDApCiAgICAgICAgICAgICAgICBzdGF0ZS5wYXJ0aWNsZXMuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgICAvLyAtLS0gTGV2ZWwgRW5kIC0tLQogICAgICAgIGNvbnN0IGRpc3RUb0VuZCA9IE1hdGguc3FydChNYXRoLnBvdyhwbGF5ZXIueCAtIGxldmVsLmVuZFBvcy54LCAyKSArIE1hdGgucG93KHBsYXllci55IC0gbGV2ZWwuZW5kUG9zLnksIDIpKTsKICAgICAgICBpZiAoZGlzdFRvRW5kIDwgMTUwICYmICghbGV2ZWwuYm9zcyB8fCBsZXZlbC5ib3NzLmhlYWx0aCA8PSAwKSkgewogICAgICAgICAgICBpZiAobGV2ZWxJbmRleCA8IFRPVEFMX0xFVkVMUykgewogICAgICAgICAgICAgICAgc2V0TGV2ZWxJbmRleChwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gcHJldiArIDE7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRMZXZlbChuZXh0LCB0cnVlKTsgLy8gS2VlcCBoZWFsdGggZm9yIG5leHQgbGV2ZWwKICAgICAgICAgICAgICAgICAgICBhdWRpb01hbmFnZXIucGxheUNvbGxlY3QoKTsgLy8gTGV2ZWwgZmluaXNoIHNvdW5kCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG9uV2luKCk7IC8vIFdpbiBpbW1lZGlhdGVseSBhZnRlciBsZXZlbCAxMgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBDYW1lcmEgRm9sbG93IC0tLQogICAgICAgIGNvbnN0IHNjcmVlblcgPSB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgICBjb25zdCBzY3JlZW5IID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIGNvbnN0IHRhcmdldENhbVggPSBwbGF5ZXIueCAtIChzY3JlZW5XIC8gMikgKyAocGxheWVyLnZ4ICogMjApOwogICAgICAgIGNvbnN0IHRhcmdldENhbVkgPSBwbGF5ZXIueSAtIChzY3JlZW5IIC8gMikgKyAocGxheWVyLnZ5ICogMTApOwogICAgICAgIC8vIFNtb290aCBMZXJwCiAgICAgICAgc3RhdGUuY2FtZXJhLnggKz0gKHRhcmdldENhbVggLSBzdGF0ZS5jYW1lcmEueCkgKiAwLjA4ICogZHQ7CiAgICAgICAgc3RhdGUuY2FtZXJhLnkgKz0gKHRhcmdldENhbVkgLSBzdGF0ZS5jYW1lcmEueSkgKiAwLjA4ICogZHQ7CiAgICAgICAgLy8gQ2xhbXAgQ2FtZXJhIHRvIExldmVsIEJvdW5kcwogICAgICAgIHN0YXRlLmNhbWVyYS54ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oc3RhdGUuY2FtZXJhLngsIGxldmVsLndpZHRoIC0gc2NyZWVuVykpOwogICAgICAgIHN0YXRlLmNhbWVyYS55ID0gTWF0aC5tYXgoLTUwMCwgTWF0aC5taW4oc3RhdGUuY2FtZXJhLnksIGxldmVsLmhlaWdodCAtIHNjcmVlbkggKyAyMDApKTsKICAgICAgICBzdGF0ZS5iYWNrZ3JvdW5kT2Zmc2V0ICs9IDAuMiAqIGR0OwogICAgICAgIC8vIERlY2F5IFNoYWtlcwogICAgICAgIGlmIChzdGF0ZS5zaGFrZSA+IDApIHsKICAgICAgICAgICAgc3RhdGUuY2FtZXJhLnggKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3RhdGUuc2hha2U7CiAgICAgICAgICAgIHN0YXRlLmNhbWVyYS55ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHN0YXRlLnNoYWtlOwogICAgICAgICAgICBzdGF0ZS5zaGFrZSAqPSAwLjk7CiAgICAgICAgICAgIGlmIChzdGF0ZS5zaGFrZSA8IDAuNSkKICAgICAgICAgICAgICAgIHN0YXRlLnNoYWtlID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlLmRhbWFnZVNoYWtlID4gMCkgewogICAgICAgICAgICBzdGF0ZS5kYW1hZ2VTaGFrZSAqPSAwLjk7CiAgICAgICAgICAgIGlmIChzdGF0ZS5kYW1hZ2VTaGFrZSA8IDAuNSkKICAgICAgICAgICAgICAgIHN0YXRlLmRhbWFnZVNoYWtlID0gMDsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgZHJhdyA9IChjdHgpID0+IHsKICAgICAgICBjb25zdCBzdGF0ZSA9IGdhbWVTdGF0ZS5jdXJyZW50OwogICAgICAgIGlmICghc3RhdGUubGV2ZWwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCB0aGVtZSA9IHN0YXRlLmxldmVsLnRoZW1lOwogICAgICAgIC8vIEZJWDogRm9yY2UgcmVzZXQgdHJhbnNmb3JtIHRvIGhhbmRsZSBEUEkgc2NhbGluZyBjb3JyZWN0bHkgZXZlcnkgZnJhbWUKICAgICAgICBjb25zdCBkcHIgPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOwogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0oZHByLCAwLCAwLCBkcHIsIDAsIDApOwogICAgICAgIGNvbnN0IHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIGRyYXdCYWNrZ3JvdW5kKGN0eCwgd2lkdGgsIGhlaWdodCwgdGhlbWUpOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgaWYgKHN0YXRlLmRhbWFnZVNoYWtlID4gMCkgewogICAgICAgICAgICBjb25zdCBkeCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHN0YXRlLmRhbWFnZVNoYWtlOwogICAgICAgICAgICBjb25zdCBkeSA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHN0YXRlLmRhbWFnZVNoYWtlOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKGR4LCBkeSk7CiAgICAgICAgfQogICAgICAgIGN0eC50cmFuc2xhdGUoLXN0YXRlLmNhbWVyYS54LCAtc3RhdGUuY2FtZXJhLnkpOwogICAgICAgIC8vIENoZWNrIGlmIGJvc3MgaXMgZGVhZCB0byBoaWRlIGVsZW1lbnRzCiAgICAgICAgY29uc3QgYm9zc0RlZmVhdGVkID0gc3RhdGUubGV2ZWwuYm9zcyAmJiBzdGF0ZS5sZXZlbC5ib3NzLmhlYWx0aCA8PSAwOwogICAgICAgIC8vIC0tLSBEcmF3IFBsYXRmb3JtcyAtLS0KICAgICAgICBzdGF0ZS5sZXZlbC5wbGF0Zm9ybXMuZm9yRWFjaChwbGF0ID0+IHsKICAgICAgICAgICAgaWYgKHBsYXQucmVuZGVyVHlwZSA9PT0gJ2ludmlzaWJsZScpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChwbGF0LnggPiBzdGF0ZS5jYW1lcmEueCArIHdpZHRoIHx8IHBsYXQueCArIHBsYXQudyA8IHN0YXRlLmNhbWVyYS54KQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAocGxhdC5yZW5kZXJUeXBlID09PSAnZ3JvdW5kJykgewogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoZW1lLnBsYXRmb3JtQ29sb3I7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QocGxhdC54LCBwbGF0LnksIHBsYXQudywgcGxhdC5oKTsKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGVtZS5wbGF0Zm9ybURldGFpbDsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChwbGF0LngsIHBsYXQueSwgcGxhdC53LCAxNSk7CiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhlbWUuYmFja2dyb3VuZFRvcDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGxhdC53OyBpICs9IDUwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKChwbGF0LnggKyBpKSAlIDIwMCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QocGxhdC54ICsgaSwgcGxhdC55ICsgMTUsIDQsIDMwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LDI1NSwyNTUsMC4xKSc7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QocGxhdC54LCBwbGF0LnksIHBsYXQudywgMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBncmFkID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KHBsYXQueCwgcGxhdC55LCBwbGF0LngsIHBsYXQueSArIHBsYXQuaCk7CiAgICAgICAgICAgICAgICBncmFkLmFkZENvbG9yU3RvcCgwLCB0aGVtZS5wbGF0Zm9ybURldGFpbCk7CiAgICAgICAgICAgICAgICBncmFkLmFkZENvbG9yU3RvcCgxLCB0aGVtZS5wbGF0Zm9ybUNvbG9yKTsKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkOwogICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgY3R4LnJvdW5kUmVjdChwbGF0LngsIHBsYXQueSwgcGxhdC53LCBwbGF0LmgsIDQpOwogICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoZW1lLmFjY2VudENvbG9yOwogICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAwLjU7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKCFib3NzRGVmZWF0ZWQpIHsKICAgICAgICAgICAgLy8gLS0tIERyYXcgQ29sbGVjdGlibGVzIChIZWFsdGgpIC0tLQogICAgICAgICAgICBzdGF0ZS5sZXZlbC5jb2xsZWN0aWJsZXMuZm9yRWFjaChjID0+IHsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGMueCArIGMudyAvIDIsIGMueSArIGMuaCAvIDIpOwogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSAxLjAgKyBNYXRoLnNpbihEYXRlLm5vdygpIC8gMjAwKSAqIDAuMTsKICAgICAgICAgICAgICAgIGN0eC5zY2FsZShzY2FsZSwgc2NhbGUpOwogICAgICAgICAgICAgICAgLy8gSGVhbHRoIFBhY2sgVmlzdWFscyAoR3JlZW4gQ3Jvc3MpCiAgICAgICAgICAgICAgICBpZiAoYy5jb2xvciA9PT0gJyMyMmM1NWUnKSB7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGMuY29sb3I7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLnJheVRyYWNpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gYy5jb2xvcjsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSAxNTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IGMudyAvIDM7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KC1zIC8gMiwgLWMuaCAvIDIsIHMsIGMuaCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KC1jLncgLyAyLCAtcyAvIDIsIGMudywgcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBTdGFuZGFyZCBIZWFydAogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGVtZS5oYXphcmRDb2xvcjsKICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MucmF5VHJhY2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBjdHguc2hhZG93Q29sb3IgPSB0aGVtZS5oYXphcmRDb2xvcjsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSAxNTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdyA9IGMudywgaCA9IGMuaDsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9wQ3VydmVIZWlnaHQgPSBoICogMC4zOwogICAgICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oMCwgdG9wQ3VydmVIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKDAsIC1oICogMC4yLCAtdyAvIDIsIC1oICogMC4yLCAtdyAvIDIsIHRvcEN1cnZlSGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBjdHguYmV6aWVyQ3VydmVUbygtdyAvIDIsIGggKiAwLjQsIDAsIGggKiAwLjUsIDAsIGggKiAwLjUpOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKDAsIGggKiAwLjUsIHcgLyAyLCBoICogMC40LCB3IC8gMiwgdG9wQ3VydmVIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKHcgLyAyLCAtaCAqIDAuMiwgMCwgLWggKiAwLjIsIDAsIHRvcEN1cnZlSGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSAwOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIC0tLSBEcmF3IFByb2plY3RpbGVzIC0tLQogICAgICAgICAgICBzdGF0ZS5sZXZlbC5wcm9qZWN0aWxlcy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHAuY29sb3I7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MucmF5VHJhY2luZykgewogICAgICAgICAgICAgICAgICAgIGN0eC5zaGFkb3dCbHVyID0gMTA7CiAgICAgICAgICAgICAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gcC5jb2xvcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5hcmMocC54LCBwLnksIHAudyAvIDIsIDAsIE1hdGguUEkgKiAyKTsgLy8gVXNlIHByb2plY3RpbGUgd2lkdGggZm9yIHNpemUKICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDA7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyAtLS0gRHJhdyBFbmVtaWVzIC0tLQogICAgICAgICAgICBzdGF0ZS5sZXZlbC5lbmVtaWVzLmZvckVhY2goZW5lbXkgPT4gewogICAgICAgICAgICAgICAgaWYgKGVuZW15LnN1YnR5cGUgPT09ICd0dXJyZXQnKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBUdXJyZXQKICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzFlMjkzYic7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KGVuZW15LngsIGVuZW15LnkgKyBlbmVteS5oIC8gMiwgZW5lbXkudywgZW5lbXkuaCAvIDIpOwogICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoZW5lbXkueCArIGVuZW15LncgLyAyLCBlbmVteS55ICsgZW5lbXkuaCAvIDIpOwogICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoRGF0ZS5ub3coKSAvIDEwMDApOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBlbmVteS5jb2xvcjsKICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MucmF5VHJhY2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBjdHguc2hhZG93Q29sb3IgPSBlbmVteS5jb2xvcjsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSAxNTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KC1lbmVteS53IC8gMiwgLWVuZW15LmggLyAyLCBlbmVteS53LCBlbmVteS5oIC8gMik7CiAgICAgICAgICAgICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSAwOwogICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChlbmVteS5zdWJ0eXBlID09PSAnZmx5ZXInKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlZCBGbHlpbmcgRW5lbXkgVmlzdWFscyAoTWVjaGFuaWNhbCBCYXQvRHJvbmUpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3ggPSBlbmVteS54ICsgZW5lbXkudyAvIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3kgPSBlbmVteS55ICsgZW5lbXkuaCAvIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvYXRPZmZzZXQgPSBNYXRoLnNpbihEYXRlLm5vdygpIC8gMjAwKSAqIDU7CiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGN4LCBjeSArIGZsb2F0T2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAvLyBXaW5ncyBBbmltYXRpb24KICAgICAgICAgICAgICAgICAgICBjb25zdCB3aW5nRmxhcCA9IE1hdGguc2luKERhdGUubm93KCkgLyA1MCk7IC8vIEZhc3QgZmxhcAogICAgICAgICAgICAgICAgICAgIC8vIExlZnQgV2luZwogICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnNjYWxlKDEsIDEgKyAod2luZ0ZsYXAgKiAwLjIpKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM0NzU1NjknOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKC0xMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbygtZW5lbXkudyAvIDIgLSAxMCwgLTIwKTsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKC1lbmVteS53IC8gMiwgMTApOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oLTEwLCA1KTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGVuZW15LmNvbG9yOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxOwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgICAgIC8vIFJpZ2h0IFdpbmcKICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5zY2FsZSgtMSwgMSArICh3aW5nRmxhcCAqIDAuMikpOyAvLyBNaXJyb3IKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM0NzU1NjknOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKC0xMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbygtZW5lbXkudyAvIDIgLSAxMCwgLTIwKTsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKC1lbmVteS53IC8gMiwgMTApOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oLTEwLCA1KTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGVuZW15LmNvbG9yOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxOwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgICAgIC8vIE1haW4gQm9keQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzBmMTcyYSc7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5lbGxpcHNlKDAsIDAsIDE1LCAxMCwgMCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gR2xvd2luZyBFeWUKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZW5lbXkuY29sb3I7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLnJheVRyYWNpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gZW5lbXkuY29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zaGFkb3dCbHVyID0gMTU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYXJjKDAsIDAsIDYsIDAsIE1hdGguUEkgKiAyKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5zaGFkb3dCbHVyID0gMDsKICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBQYXRyb2xsZXIKICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gZW5lbXkueCArIGVuZW15LncgLyAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN5ID0gZW5lbXkueSArIGVuZW15LmggLyAyOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBlbmVteS5jb2xvcjsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIGVuZW15LncgLyAyLCBNYXRoLlBJLCAwKTsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKGN4ICsgZW5lbXkudyAvIDIsIGN5ICsgZW5lbXkuaCAvIDIpOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oY3ggLSBlbmVteS53IC8gMiwgY3kgKyBlbmVteS5oIC8gMik7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAnOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyhjeCAtIDEwICsgKGkgKiAxMCksIGN5IC0gMTApOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKGN4IC0gNSArIChpICogMTApLCBjeSAtIDI1KTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIChpICogMTApLCBjeSAtIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBCb3NzIFJlbmRlciAoVXBkYXRlZCkgLS0tCiAgICAgICAgaWYgKHN0YXRlLmxldmVsLmJvc3MgJiYgc3RhdGUubGV2ZWwuYm9zcy5oZWFsdGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSBzdGF0ZS5sZXZlbC5ib3NzOwogICAgICAgICAgICBjb25zdCBwaGFzZSA9IGIucGhhc2UgfHwgMTsKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShiLnggKyBiLncgLyAyLCBiLnkgKyBiLmggLyAyKTsKICAgICAgICAgICAgY29uc3QgaXNUaXJlZCA9IGIudGlyZWRUaW1lciAmJiBiLnRpcmVkVGltZXIgPiAwOwogICAgICAgICAgICAvLyBEcmF3IExvY2sgTGluZSBmb3IgQm9zcyAyCiAgICAgICAgICAgIGlmIChiLmRhc2hTdGF0ZSA9PT0gJ2xvY2tpbmcnICYmIGIudGFyZ2V0WCAhPT0gdW5kZWZpbmVkICYmIGIudGFyZ2V0WSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgLy8gRHJhdyBkYXNoZWQgbGluZSBmcm9tIGJvc3MgdG8gdGFyZ2V0CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnI2VmNDQ0NCc7CiAgICAgICAgICAgICAgICBjdHguc2V0TGluZURhc2goWzEwLCAxMF0pOwogICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHVudHJhbnNsYXRlIGZpcnN0IHRvIGRyYXcgaW4gd29ybGQgY29vcmRpbmF0ZXMgb3IgY2FsY3VsYXRlIHJlbGF0aXZlCiAgICAgICAgICAgICAgICAvLyBFYXNpZXIgdG8ganVzdCB1c2UgcmVsYXRpdmUgY29vcmRzIGhlcmUKICAgICAgICAgICAgICAgIGNvbnN0IHJlbFggPSBiLnRhcmdldFggLSAoYi54ICsgYi53IC8gMik7CiAgICAgICAgICAgICAgICBjb25zdCByZWxZID0gYi50YXJnZXRZIC0gKGIueSArIGIuaCAvIDIpOwogICAgICAgICAgICAgICAgLy8gRXh0ZW5kIGxpbmUgZmFyIG91dAogICAgICAgICAgICAgICAgY3R4Lm1vdmVUbygwLCAwKTsKICAgICAgICAgICAgICAgIGN0eC5saW5lVG8ocmVsWCAqIDEwLCByZWxZICogMTApOwogICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBHbGl0Y2ggU2hha2UKICAgICAgICAgICAgY29uc3Qgc2hha2UgPSBwaGFzZSA9PT0gMyA/IDUgOiAwOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHNoYWtlLCAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZSk7CiAgICAgICAgICAgIC8vIENvcmUgU2hhcGUKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGlzVGlyZWQgPyAnIzk0YTNiOCcgOiBiLmNvbG9yOyAvLyBHcmV5IHdoZW4gdGlyZWQKICAgICAgICAgICAgaWYgKHNldHRpbmdzLnJheVRyYWNpbmcgJiYgIWlzVGlyZWQpIHsKICAgICAgICAgICAgICAgIGN0eC5zaGFkb3dCbHVyID0gcGhhc2UgKiAyMDsKICAgICAgICAgICAgICAgIGN0eC5zaGFkb3dDb2xvciA9IGIuY29sb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gUm90YXRlIGJhc2VkIG9uIHBoYXNlIGFnZ3Jlc3Npb24KICAgICAgICAgICAgaWYgKCFpc1RpcmVkKQogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShEYXRlLm5vdygpIC8gKDEwMDAgLyBwaGFzZSkpOwogICAgICAgICAgICBjb25zdCBzaXplID0gYi53OwogICAgICAgICAgICAvLyBQaGFzZSAxOiBTcXVhcmUKICAgICAgICAgICAgLy8gUGhhc2UgMjogVHJpYW5nbGUKICAgICAgICAgICAgLy8gUGhhc2UgMzogU3Bpa3kgQ2hhb3MKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBpZiAocGhhc2UgPT09IDEpIHsKICAgICAgICAgICAgICAgIGN0eC5yZWN0KC1zaXplIC8gMiwgLXNpemUgLyAyLCBzaXplLCBzaXplKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChwaGFzZSA9PT0gMikgewogICAgICAgICAgICAgICAgY3R4Lm1vdmVUbygwLCAtc2l6ZSAvIDEuNSk7CiAgICAgICAgICAgICAgICBjdHgubGluZVRvKHNpemUgLyAxLjUsIHNpemUgLyAxLjUpOwogICAgICAgICAgICAgICAgY3R4LmxpbmVUbygtc2l6ZSAvIDEuNSwgc2l6ZSAvIDEuNSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBzcGlrZXMgPSA4OwogICAgICAgICAgICAgICAgY29uc3Qgb3V0ZXIgPSBzaXplIC8gMS41OwogICAgICAgICAgICAgICAgY29uc3QgaW5uZXIgPSBzaXplIC8gMzsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3Bpa2VzICogMjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IGkgJSAyID09PSAwID8gb3V0ZXIgOiBpbm5lcjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gKE1hdGguUEkgKiBpKSAvIHNwaWtlczsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKE1hdGguY29zKGEpICogciwgTWF0aC5zaW4oYSkgKiByKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgIC8vIElubmVyIEV5ZQogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAnOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5hcmMoMCwgMCwgMTAsIDAsIE1hdGguUEkgKiAyKTsKICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgLy8gVGlyZWQgUGFydGljbGVzCiAgICAgICAgICAgIGlmIChpc1RpcmVkKSB7CiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMzYjgyZjYnOyAvLyBCbHVlIHN3ZWF0CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gRGF0ZS5ub3coKSAvIDIwMDsKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5hcmMoc2l6ZSAvIDIgKyBNYXRoLnNpbih0KSAqIDEwLCAtc2l6ZSAvIDIsIDUsIDAsIE1hdGguUEkgKiAyKTsKICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHguYXJjKC1zaXplIC8gMiAtIE1hdGguc2luKHQpICogMTAsIC1zaXplIC8gMiwgNSwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDA7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIC8vIEhlYWx0aCBCYXIKICAgICAgICAgICAgY29uc3QgaHBQZXJjZW50ID0gYi5oZWFsdGggLyBiLm1heEhlYWx0aDsKICAgICAgICAgICAgY29uc3QgYmFyVyA9IDgwMDsKICAgICAgICAgICAgLy8gT25seSBkcmF3IGJvc3MgYmFyIGlmIG9uIHNjcmVlbgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguc2V0VHJhbnNmb3JtKGRwciwgMCwgMCwgZHByLCAwLCAwKTsgLy8gSFVEIHRyYW5zZm9ybQogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMCwwLDAsMC44KSc7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdCh3aWR0aCAvIDIgLSA0MDAsIDgwLCA4MDAsIDMwKTsKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGIuY29sb3I7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdCh3aWR0aCAvIDIgLSA0MDAgKyA0LCA4NCwgKDc5MiAqIGhwUGVyY2VudCksIDIyKTsKICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyNmZmYnOwogICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMjsKICAgICAgICAgICAgY3R4LnN0cm9rZVJlY3Qod2lkdGggLyAyIC0gNDAwLCA4MCwgODAwLCAzMCk7CiAgICAgICAgICAgIC8vIEJvc3MgTmFtZQogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmYnOwogICAgICAgICAgICBjdHguZm9udCA9ICcyNHB4IENpbnplbCc7CiAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICAgICAgY3R4LmZpbGxUZXh0KHN0YXRlLmxldmVsLmlkID09PSAxMiA/ICJUSEUgQVJDSElURUNUIiA6ICJUSEUgRURJVE9SIiwgd2lkdGggLyAyLCA3MCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBEcmF3IFBsYXllciAtLS0KICAgICAgICBjb25zdCBwID0gc3RhdGUucGxheWVyOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgLy8gSW52aW5jaWJpbGl0eSBGbGFzaAogICAgICAgIGlmIChwLmludmluY2libGVUaW1lciA+IDApIHsKICAgICAgICAgICAgLy8gRmxhc2ggZXZlcnkgMC4xcwogICAgICAgICAgICBpZiAoTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwKSAlIDIgPT09IDApIHsKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDAuMzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBzcHJpdGUgPSB0aW50ZWRQbGF5ZXJDYW52YXMuY3VycmVudCB8fCBwbGF5ZXJJbWFnZS5jdXJyZW50OwogICAgICAgIGlmIChzcHJpdGUgJiYgcGxheWVySW1hZ2UuY3VycmVudC5jb21wbGV0ZSAmJiBwbGF5ZXJJbWFnZS5jdXJyZW50Lm5hdHVyYWxXaWR0aCA+IDApIHsKICAgICAgICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIGN0eC5pbWFnZVNtb290aGluZ1F1YWxpdHkgPSAnaGlnaCc7CiAgICAgICAgICAgIGlmICghcC5mYWNpbmdSaWdodCkgewogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShwLnggKyBwLncsIHAueSk7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoLTEsIDEpOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShzcHJpdGUsIDAsIDAsIHAudywgcC5oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3ByaXRlLCBwLngsIHAueSwgcC53LCBwLmgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gc2V0dGluZ3MucGxheWVyQ29sb3I7IC8vIEZhbGxiYWNrIHRvIHNldHRpbmdzIGNvbG9yCiAgICAgICAgICAgIGN0eC5maWxsUmVjdChwLngsIHAueSwgcC53LCBwLmgpOwogICAgICAgIH0KICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIC8vIC0tLSBQYXJ0aWNsZXMgLS0tCiAgICAgICAgaWYgKCFib3NzRGVmZWF0ZWQpIHsKICAgICAgICAgICAgc3RhdGUucGFydGljbGVzLmZvckVhY2gocHQgPT4gewogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gcHQubGlmZTsKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBwdC5jb2xvcjsKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5hcmMocHQueCwgcHQueSwgcHQuc2l6ZSwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEuMDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBFeGl0IFBvcnRhbCAoQmxhY2sgSG9sZSkgLS0tCiAgICAgICAgLy8gSWYgQm9zcyBMZXZlbDogSGlkZSBwb3J0YWwgaWYgYm9zcyBpcyBhbGl2ZQogICAgICAgIGNvbnN0IHNob3dQb3J0YWwgPSAhKHN0YXRlLmxldmVsLmJvc3MgJiYgc3RhdGUubGV2ZWwuYm9zcy5oZWFsdGggPiAwKTsKICAgICAgICBpZiAoc2hvd1BvcnRhbCkgewogICAgICAgICAgICBjb25zdCBlbmQgPSBzdGF0ZS5sZXZlbC5lbmRQb3M7CiAgICAgICAgICAgIGNvbnN0IHQgPSBEYXRlLm5vdygpIC8gMTAwMDsKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShlbmQueCwgZW5kLnkpOwogICAgICAgICAgICAvLyBBY2NyZXRpb24gRGlzayBSb3RhdGlvbgogICAgICAgICAgICBjdHgucm90YXRlKHQgKiAwLjUpOwogICAgICAgICAgICAvLyBCbGFjayBIb2xlIEdsb3cgKEFjY3JldGlvbiBEaXNrKQogICAgICAgICAgICBjb25zdCBncmFkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDAsIDAsIDIwLCAwLCAwLCA3MCk7CiAgICAgICAgICAgIGdyYWQuYWRkQ29sb3JTdG9wKDAsICcjMDAwJyk7CiAgICAgICAgICAgIGdyYWQuYWRkQ29sb3JTdG9wKDAuMywgdGhlbWUuYWNjZW50Q29sb3IpOwogICAgICAgICAgICBncmFkLmFkZENvbG9yU3RvcCgwLjUsICd0cmFuc3BhcmVudCcpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JhZDsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHguYXJjKDAsIDAsIDcwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgIC8vIEV2ZW50IEhvcml6b24gKFBpdGNoIEJsYWNrKQogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwMCc7CiAgICAgICAgICAgIGN0eC5hcmMoMCwgMCwgMzAsIDAsIE1hdGguUEkgKiAyKTsKICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgLy8gUGhvdG9uIFNwaGVyZSAoV2hpdGUgUmltKQogICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpJzsKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYygwLCAwLCAzMCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgIC8vIFBhcnRpY2xlcyBiZWluZyBzdWNrZWQgaW4KICAgICAgICAgICAgaWYgKHNldHRpbmdzLnBhcnRpY2xlcykgewogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSgtdCAqIDAuNSk7IC8vIFJlc2V0IHJvdGF0aW9uIGZvciBwYXJ0aWNsZXMKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSAodCAqIDIpICsgKGkgKiAoTWF0aC5QSSAvIDQpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByYWRpdXMgPSA0MCArIE1hdGguc2luKHQgKiA1ICsgaSkgKiAxMDsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmYnOwogICAgICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDAuNTsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhNYXRoLmNvcyhhbmdsZSkgKiByYWRpdXMsIE1hdGguc2luKGFuZ2xlKSAqIHJhZGl1cywgMiwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgLy8gLS0tIExpZ2h0aW5nL1ZpZ25ldHRlIC0tLQogICAgICAgIGlmIChzZXR0aW5ncy5yYXlUcmFjaW5nKSB7CiAgICAgICAgICAgIGNvbnN0IGdyYWQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoc3RhdGUucGxheWVyLnggKyBwLncgLyAyLCBzdGF0ZS5wbGF5ZXIueSArIHAuaCAvIDIsIDEwMCwgc3RhdGUucGxheWVyLnggKyBwLncgLyAyLCBzdGF0ZS5wbGF5ZXIueSArIHAuaCAvIDIsIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICAgICAgICAgIGdyYWQuYWRkQ29sb3JTdG9wKDAsICdyZ2JhKDAsMCwwLDApJyk7CiAgICAgICAgICAgIGdyYWQuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDAsMCwwLDAuNyknKTsKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyYWQ7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdChzdGF0ZS5jYW1lcmEueCwgc3RhdGUuY2FtZXJhLnksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIH0KICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgfTsKICAgIGNvbnN0IGxvb3AgPSB1c2VDYWxsYmFjaygodGltZSkgPT4gewogICAgICAgIGlmICghY2FudmFzUmVmLmN1cnJlbnQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCBjdHggPSBjYW52YXNSZWYuY3VycmVudC5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGlmICghY3R4KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgLy8gRml4ZWQgVGltZXN0ZXAgTG9vcCAoNjAgdXBkYXRlcyBwZXIgc2Vjb25kKQogICAgICAgIGNvbnN0IEZJWEVEX1NURVAgPSAxNi42NzsgLy8gbXMgcGVyIGZyYW1lCiAgICAgICAgbGV0IGRlbHRhVGltZSA9IHRpbWUgLSBnYW1lU3RhdGUuY3VycmVudC5sYXN0VGltZTsKICAgICAgICAvLyBDYXAgZHQgdG8gcHJldmVudCBzcGlyYWwgb2YgZGVhdGggb24gbGFnL3RhYiBzd2l0Y2gKICAgICAgICBpZiAoZGVsdGFUaW1lID4gMTAwKQogICAgICAgICAgICBkZWx0YVRpbWUgPSAxMDA7CiAgICAgICAgZ2FtZVN0YXRlLmN1cnJlbnQubGFzdFRpbWUgPSB0aW1lOwogICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmFjY3VtdWxhdG9yICs9IGRlbHRhVGltZTsKICAgICAgICB3aGlsZSAoZ2FtZVN0YXRlLmN1cnJlbnQuYWNjdW11bGF0b3IgPj0gRklYRURfU1RFUCkgewogICAgICAgICAgICB1cGRhdGUoMS4wKTsgLy8gQWx3YXlzIHVwZGF0ZSB3aXRoIGR0PTEuMCBsb2dpYy13aXNlCiAgICAgICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmFjY3VtdWxhdG9yIC09IEZJWEVEX1NURVA7CiAgICAgICAgfQogICAgICAgIGlmIChnYW1lU3RhdGUuY3VycmVudC5wbGF5ZXIuaGVhbHRoIDw9IDAgJiYgIWdhbWVPdmVyKQogICAgICAgICAgICBzZXRHYW1lT3Zlcih0cnVlKTsKICAgICAgICBkcmF3KGN0eCk7CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApOwogICAgfSwgW3BhdXNlZCwgbGV2ZWxJbmRleCwgc2V0dGluZ3MsIGdhbWVPdmVyLCBzaG93VGVybWluYWxdKTsgLy8gUmVtb3ZlZCAnaGVhbHRoJyBkZXBlbmRlbmN5CiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIGNvbnN0IGFuaW1hdGlvbklkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApOwogICAgICAgIGNvbnN0IGhhbmRsZUtleURvd24gPSAoZSkgPT4gewogICAgICAgICAgICAvLyBUb2dnbGUgVGVybWluYWwKICAgICAgICAgICAgaWYgKChlLm1ldGFLZXkgfHwgZS5jdHJsS2V5KSAmJiBlLmtleS50b0xvd2VyQ2FzZSgpID09PSAnbCcpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHNldFNob3dUZXJtaW5hbChwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gIXByZXY7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmtleXMgPSB7fTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzaG93VGVybWluYWwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGdhbWVTdGF0ZS5jdXJyZW50LmtleXNbZS5rZXldID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRXNjYXBlJykKICAgICAgICAgICAgICAgIHNldFBhdXNlZChwID0+ICFwKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGhhbmRsZUtleVVwID0gKGUpID0+IGdhbWVTdGF0ZS5jdXJyZW50LmtleXNbZS5rZXldID0gZmFsc2U7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duKTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBoYW5kbGVLZXlVcCk7CiAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uSWQpOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleURvd24pOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBoYW5kbGVLZXlVcCk7CiAgICAgICAgfTsKICAgIH0sIFtsb29wLCBzaG93VGVybWluYWxdKTsKICAgIGlmIChnYW1lT3ZlcikgewogICAgICAgIHJldHVybiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJmaXhlZCBpbnNldC0wIGJnLWJsYWNrIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtd2hpdGUgei01MCBhbmltYXRlLWZhZGUtaW4iLCBjaGlsZHJlbjogX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC1jZW50ZXIgcC04IGJvcmRlciBib3JkZXItcmVkLTkwMC81MCBiZy1yZWQtOTUwLzIwIHJvdW5kZWQteGwgYmFja2Ryb3AtYmx1ci1zbSIsIGNoaWxkcmVuOiBbX2pzeCgiaDEiLCB7IGNsYXNzTmFtZTogInRleHQtNnhsIGZvbnQtY2luemVsIHRleHQtcmVkLTYwMCBtYi00IGRyb3Atc2hhZG93LVswXzBfMTBweF9yZ2JhKDIyMCwzOCwzOCwwLjUpXSIsIGNoaWxkcmVuOiAiWU9VIERJRUQiIH0pLCBfanN4KCJwIiwgeyBjbGFzc05hbWU6ICJtYi04IG9wYWNpdHktNzAgZm9udC1jaW56ZWwgdGV4dC14bCIsIGNoaWxkcmVuOiAiVGhlIGluayBoYXMgZHJpZWQgb24geW91ciBzdG9yeS4iIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGdhcC00IGp1c3RpZnktY2VudGVyIiwgY2hpbGRyZW46IFtfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IGhhbmRsZVJlc3RhcnQsIGNsYXNzTmFtZTogInB4LTggcHktMyBiZy13aGl0ZSB0ZXh0LWJsYWNrIGZvbnQtYm9sZCByb3VuZGVkIGhvdmVyOmJnLWdyYXktMjAwIHRyYW5zaXRpb24tdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSIsIGNoaWxkcmVuOiAiVFJZIEFHQUlOIiB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBvbkV4aXQsIGNsYXNzTmFtZTogInB4LTggcHktMyBib3JkZXIgYm9yZGVyLXdoaXRlLzMwIHRleHQtd2hpdGUgZm9udC1ib2xkIHJvdW5kZWQgaG92ZXI6Ymctd2hpdGUvMTAgdHJhbnNpdGlvbi1jb2xvcnMiLCBjaGlsZHJlbjogIkdJVkUgVVAiIH0pXSB9KV0gfSkgfSkpOwogICAgfQogICAgcmV0dXJuIChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJyZWxhdGl2ZSB3LWZ1bGwgaC1zY3JlZW4gYmctbmV1dHJhbC05MDAgb3ZlcmZsb3ctaGlkZGVuIGN1cnNvci1ub25lIiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSB0b3AtNCBsZWZ0LTQgei0xMCBmbGV4IGdhcC00IHRleHQtd2hpdGUiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImJnLWJsYWNrLzUwIHAtNCByb3VuZGVkLWxnIGJhY2tkcm9wLWJsdXItc20gYm9yZGVyIGJvcmRlci13aGl0ZS8xMCBzaGFkb3ctbGciLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInRleHQtc20gdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVzdCBvcGFjaXR5LTUwIG1iLTEgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiLCBjaGlsZHJlbjogW19qc3goU3BhcmtsZXMsIHsgc2l6ZTogMTIgfSksICIgVml0YWxpdHkiXSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGdhcC0yIiwgY2hpbGRyZW46IFsuLi5BcnJheSg1KV0ubWFwKChfLCBpKSA9PiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6IGB3LTUgaC01IHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCB0cmFuc2Zvcm0gJHtpIDwgaGVhbHRoID8gJ3NjYWxlLTEwMCcgOiAnc2NhbGUtNzUgb3BhY2l0eS0zMCd9YCwgY2hpbGRyZW46IF9qc3goInN2ZyIsIHsgdmlld0JveDogIjAgMCAyNCAyNCIsIGZpbGw6IGkgPCBoZWFsdGggPyAiI2ZiNzE4NSIgOiAibm9uZSIsIHN0cm9rZTogIiNmZmYiLCBjbGFzc05hbWU6ICJ3LWZ1bGwgaC1mdWxsIGRyb3Atc2hhZG93LW1kIiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IGQ6ICJNMjAuODQgNC42MWE1LjUgNS41IDAgMCAwLTcuNzggMEwxMiA1LjY3bC0xLjA2LTEuMDZhNS41IDUuNSAwIDAgMC03Ljc4IDcuNzhsMS4wNiAxLjA2TDEyIDIxLjIzbDcuNzgtNy43OCAxLjA2LTEuMDZhNS41IDUuNSAwIDAgMCAwLTcuNzh6IiB9KSB9KSB9LCBpKSkpIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiYmctYmxhY2svNTAgcC00IHJvdW5kZWQtbGcgYmFja2Ryb3AtYmx1ci1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHNoYWRvdy1sZyIsIGNoaWxkcmVuOiBbX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXNtIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3Qgb3BhY2l0eS01MCBtYi0xIiwgY2hpbGRyZW46ICJDaHJvbmljbGUiIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmb250LWNpbnplbCB0ZXh0LXhsIHRleHQtd2hpdGUiLCBjaGlsZHJlbjogW2dhbWVTdGF0ZS5jdXJyZW50LmxldmVsPy5uYW1lIHx8IGxldmVsSW5kZXgsIF9qc3hzKCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhzIG9wYWNpdHktNTAgbWwtMiIsIGNoaWxkcmVuOiBbIi8gIiwgVE9UQUxfTEVWRUxTXSB9KV0gfSldIH0pXSB9KSwgc2hvd1Rlcm1pbmFsICYmIChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSB0b3AtMCBsZWZ0LTAgdy1mdWxsIGJnLWJsYWNrLzkwIHRleHQtZ3JlZW4tNDAwIGZvbnQtbW9ubyB0ZXh0LXNtIHotNTAgYm9yZGVyLWIgYm9yZGVyLWdyZWVuLTkwMCBzaGFkb3cteGwgcC00IGFuaW1hdGUtc2xpZGUtZG93biIsIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgbWItMiBib3JkZXItYiBib3JkZXItZ3JlZW4tOTAwLzUwIHBiLTIiLCBjaGlsZHJlbjogW19qc3goVGVybWluYWwsIHsgc2l6ZTogMTYgfSksIF9qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogImZvbnQtYm9sZCIsIGNoaWxkcmVuOiAiRkxPVU5ERVJfREVWX0NPTlNPTEUiIH0pXSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJtYXgtaC00MCBvdmVyZmxvdy15LWF1dG8gbWItMiBzcGFjZS15LTEgb3BhY2l0eS04MCIsIGNoaWxkcmVuOiB0ZXJtTG9nLm1hcCgobG9nLCBpKSA9PiBfanN4KCJkaXYiLCB7IGNoaWxkcmVuOiBsb2cgfSwgaSkpIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGdhcC0yIGl0ZW1zLWNlbnRlciIsIGNoaWxkcmVuOiBbX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmVlbi02MDAiLCBjaGlsZHJlbjogJz4nIH0pLCBfanN4KCJpbnB1dCIsIHsgcmVmOiB0ZXJtaW5hbElucHV0UmVmLCB0eXBlOiAidGV4dCIsIHZhbHVlOiB0ZXJtSW5wdXQsIG9uQ2hhbmdlOiAoZSkgPT4gc2V0VGVybUlucHV0KGUudGFyZ2V0LnZhbHVlKSwgb25LZXlEb3duOiAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOyAvLyBQcmV2ZW50IGdhbWUga2V5cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjdXRlQ29tbWFuZCh0ZXJtSW5wdXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNsYXNzTmFtZTogImJnLXRyYW5zcGFyZW50IGJvcmRlci1ub25lIG91dGxpbmUtbm9uZSBmbGV4LTEgdGV4dC1ncmVlbi00MDAgcGxhY2Vob2xkZXItZ3JlZW4tOTAwIiwgcGxhY2Vob2xkZXI6ICJFbnRlciBjb21tYW5kLi4uIiB9KV0gfSldIH0pKSwgcGF1c2VkICYmIChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBpbnNldC0wIGJnLWJsYWNrLzgwIGJhY2tkcm9wLWJsdXItbWQgei00MCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBhbmltYXRlLWZhZGUtaW4iLCBjaGlsZHJlbjogW19qc3goImgyIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LTV4bCBmb250LWNpbnplbCB0ZXh0LXdoaXRlIG1iLTEwIHRyYWNraW5nLXdpZGVyIiwgY2hpbGRyZW46ICJQQVVTRUQiIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGZsZXgtY29sIGdhcC00IHctNjQiLCBjaGlsZHJlbjogW19qc3goImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gc2V0UGF1c2VkKGZhbHNlKSwgY2xhc3NOYW1lOiAicHgtNiBweS00IGJnLXdoaXRlIHRleHQtYmxhY2sgaG92ZXI6c2NhbGUtMTA1IHRyYW5zaXRpb24tYWxsIGZvbnQtYm9sZCB0cmFja2luZy13aWRlc3QiLCBjaGlsZHJlbjogIlJFU1VNRSIgfSksIF9qc3goImJ1dHRvbiIsIHsgb25DbGljazogaGFuZGxlUmVzdGFydCwgY2xhc3NOYW1lOiAicHgtNiBweS00IGJvcmRlciBib3JkZXItd2hpdGUvMjAgdGV4dC13aGl0ZSBob3ZlcjpiZy13aGl0ZS8xMCB0cmFuc2l0aW9uLWFsbCB0cmFja2luZy13aWRlc3QiLCBjaGlsZHJlbjogIlJFU1RBUlQgTEVWRUwiIH0pLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IG9uRXhpdCwgY2xhc3NOYW1lOiAicHgtNiBweS00IGJvcmRlciBib3JkZXItcmVkLTUwMC81MCB0ZXh0LXJlZC00MDAgaG92ZXI6YmctcmVkLTk1MC8zMCB0cmFuc2l0aW9uLWFsbCB0cmFja2luZy13aWRlc3QiLCBjaGlsZHJlbjogIkVYSVQgVE8gTUVOVSIgfSldIH0pXSB9KSksIF9qc3goImNhbnZhcyIsIHsgcmVmOiBjYW52YXNSZWYsIGNsYXNzTmFtZTogImJsb2NrIHctZnVsbCBoLWZ1bGwiIH0pLCBsb2FkaW5nICYmIChfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGluc2V0LTAgYmctYmxhY2sgei01MCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXdoaXRlIiwgY2hpbGRyZW46IF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIiwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInctMTIgaC0xMiBib3JkZXItNCBib3JkZXItd2hpdGUgYm9yZGVyLXQtdHJhbnNwYXJlbnQgcm91bmRlZC1mdWxsIGFuaW1hdGUtc3BpbiBtYi00IiB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJmb250LWNpbnplbCB0ZXh0LTJ4bCB0cmFja2luZy13aWRlc3QgYW5pbWF0ZS1wdWxzZSIsIGNoaWxkcmVuOiAiTE9BRElORyIgfSldIH0pIH0pKV0gfSkpOwp9Owo=","@/components/MainMenu":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnOwppbXBvcnQgeyBQbGF5LCBTZXR0aW5ncywgTW9uaXRvciwgQ3B1LCBQYWxldHRlIH0gZnJvbSAnbHVjaWRlLXJlYWN0JzsKaW1wb3J0IHsgRkxPVU5ERVJfTE9HT19VUkwsIFBMQVlFUl9DT0xPUlMgfSBmcm9tICdAL2NvbnN0YW50cyc7CmV4cG9ydCBjb25zdCBNYWluTWVudSA9ICh7IG9uU3RhcnQsIHNldHRpbmdzLCBzZXRTZXR0aW5ncyB9KSA9PiB7CiAgICBjb25zdCBbc2hvd1NldHRpbmdzLCBzZXRTaG93U2V0dGluZ3NdID0gdXNlU3RhdGUoZmFsc2UpOwogICAgY29uc3QgdG9nZ2xlU2V0dGluZyA9IChrZXkpID0+IHsKICAgICAgICBzZXRTZXR0aW5ncyh7IC4uLnNldHRpbmdzLCBba2V5XTogIXNldHRpbmdzW2tleV0gfSk7CiAgICB9OwogICAgY29uc3QgY3ljbGVDb2xvciA9ICgpID0+IHsKICAgICAgICBjb25zdCBjdXJyZW50SW5kZXggPSBQTEFZRVJfQ09MT1JTLmZpbmRJbmRleChjID0+IGMudmFsdWUgPT09IHNldHRpbmdzLnBsYXllckNvbG9yKTsKICAgICAgICBjb25zdCBuZXh0SW5kZXggPSAoY3VycmVudEluZGV4ICsgMSkgJSBQTEFZRVJfQ09MT1JTLmxlbmd0aDsKICAgICAgICBzZXRTZXR0aW5ncyh7IC4uLnNldHRpbmdzLCBwbGF5ZXJDb2xvcjogUExBWUVSX0NPTE9SU1tuZXh0SW5kZXhdLnZhbHVlIH0pOwogICAgfTsKICAgIGNvbnN0IGN1cnJlbnRDb2xvck5hbWUgPSBQTEFZRVJfQ09MT1JTLmZpbmQoYyA9PiBjLnZhbHVlID09PSBzZXR0aW5ncy5wbGF5ZXJDb2xvcik/Lm5hbWUgfHwgJ1Vua25vd24nOwogICAgcmV0dXJuIChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJyZWxhdGl2ZSB3LWZ1bGwgaC1zY3JlZW4gYmctYmxhY2sgdGV4dC13aGl0ZSBvdmVyZmxvdy1oaWRkZW4gZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgaW5zZXQtMCBvcGFjaXR5LTIwIGJnLVt1cmwoJ2h0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTE4NzA5MjY4ODA1LTRlOTA0MmFmOWYyMz9xPTgwJnc9MjU2OCZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCcpXSBiZy1jb3ZlciBiZy1jZW50ZXIgZmlsdGVyIGdyYXlzY2FsZSBjb250cmFzdC0xNTAiIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGluc2V0LTAgYmctZ3JhZGllbnQtdG8tdCBmcm9tLWJsYWNrIHZpYS10cmFuc3BhcmVudCB0by1ibGFjayIgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInotMTAgdGV4dC1jZW50ZXIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgYW5pbWF0ZS1mYWRlLWluIiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJyZWxhdGl2ZSBncm91cCBjdXJzb3ItcG9pbnRlciBtYi02Iiwgb25DbGljazogY3ljbGVDb2xvciwgdGl0bGU6ICJDbGljayB0byBjaGFuZ2UgY2hhcmFjdGVyIGNvbG9yIiwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGluc2V0LTAgYmctd2hpdGUgb3BhY2l0eS0wIGdyb3VwLWhvdmVyOm9wYWNpdHktMTAgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tb3BhY2l0eSBibHVyLXhsIiB9KSwgX2pzeCgiaW1nIiwgeyBzcmM6IEZMT1VOREVSX0xPR09fVVJMLCBhbHQ6ICJGbG91bmRlciBMb2dvIiwgY2xhc3NOYW1lOiAidy0zMiBoLTMyIGRyb3Atc2hhZG93LVswXzBfMTVweF9yZ2JhKDI1NSwyNTUsMjU1LDAuNSldIHRyYW5zaXRpb24tdHJhbnNmb3JtIGdyb3VwLWhvdmVyOnNjYWxlLTExMCBhY3RpdmU6c2NhbGUtOTUiLCBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6IHNldHRpbmdzLnBsYXllckNvbG9yICE9PSAnI2ZmZmZmZicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gYGRyb3Atc2hhZG93KDAgMCAxMHB4ICR7c2V0dGluZ3MucGxheWVyQ29sb3J9KWAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB9KSwgc2V0dGluZ3MucGxheWVyQ29sb3IgIT09ICcjZmZmZmZmJyAmJiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBpbnNldC0wIG1peC1ibGVuZC1tdWx0aXBseSBwb2ludGVyLWV2ZW50cy1ub25lIiwgc3R5bGU6IHsgYmFja2dyb3VuZENvbG9yOiBzZXR0aW5ncy5wbGF5ZXJDb2xvciwgbWFza0ltYWdlOiBgdXJsKCR7RkxPVU5ERVJfTE9HT19VUkx9KWAsIG1hc2tTaXplOiAnY29udGFpbicsIG1hc2tSZXBlYXQ6ICduby1yZXBlYXQnLCBtYXNrUG9zaXRpb246ICdjZW50ZXInIH0gfSkpLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIC1ib3R0b20tNiB3LWZ1bGwgdGV4dC1jZW50ZXIgdGV4dC14cyB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXN0IG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkiLCBjaGlsZHJlbjogY3VycmVudENvbG9yTmFtZSB9KV0gfSksIF9qc3goImgxIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LTZ4bCBtZDp0ZXh0LTh4bCBmb250LWNpbnplbCBtYi0yIHRyYWNraW5nLXRpZ2h0ZXIiLCBjaGlsZHJlbjogIlRIRSBGTE9VTkRFUiIgfSksIF9qc3goImgyIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIG1kOnRleHQtM3hsIGZvbnQtbGlnaHQgb3BhY2l0eS03MCBtYi0xMiB0cmFja2luZy1bMC41ZW1dIHVwcGVyY2FzZSIsIGNoaWxkcmVuOiAiQ2hyb25pY2xlcyIgfSksICFzaG93U2V0dGluZ3MgPyAoX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LWNvbCBnYXAtNCB3LTY0IiwgY2hpbGRyZW46IFtfanN4cygiYnV0dG9uIiwgeyBvbkNsaWNrOiBvblN0YXJ0LCBjbGFzc05hbWU6ICJncm91cCByZWxhdGl2ZSBweC04IHB5LTQgYmctd2hpdGUgdGV4dC1ibGFjayBmb250LWJvbGQgdGV4dC1sZyBvdmVyZmxvdy1oaWRkZW4gdHJhbnNpdGlvbi1hbGwgaG92ZXI6c2NhbGUtMTA1IiwgY2hpbGRyZW46IFtfanN4cygic3BhbiIsIHsgY2xhc3NOYW1lOiAicmVsYXRpdmUgei0xMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiIsIGNoaWxkcmVuOiBbX2pzeChQbGF5LCB7IHNpemU6IDIwIH0pLCAiIFNUQVJUIEdBTUUiXSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBpbnNldC0wIGJnLWJsdWUtNDAwIHRyYW5zZm9ybSBzY2FsZS14LTAgZ3JvdXAtaG92ZXI6c2NhbGUteC0xMDAgdHJhbnNpdGlvbi10cmFuc2Zvcm0gb3JpZ2luLWxlZnQgZHVyYXRpb24tMzAwIG9wYWNpdHktMjAiIH0pXSB9KSwgX2pzeHMoImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gc2V0U2hvd1NldHRpbmdzKHRydWUpLCBjbGFzc05hbWU6ICJweC04IHB5LTQgYm9yZGVyIGJvcmRlci13aGl0ZS8yMCB0ZXh0LXdoaXRlIGhvdmVyOmJnLXdoaXRlLzEwIHRyYW5zaXRpb24tYWxsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIiwgY2hpbGRyZW46IFtfanN4KFNldHRpbmdzLCB7IHNpemU6IDE4IH0pLCAiIFNFVFRJTkdTIl0gfSldIH0pKSA6IChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJ3LTk2IGJnLWJsYWNrLzgwIGJvcmRlciBib3JkZXItd2hpdGUvMTAgcC04IGJhY2tkcm9wLWJsdXItbWQgcm91bmRlZC1sZyIsIGNoaWxkcmVuOiBbX2pzeCgiaDMiLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIGZvbnQtY2luemVsIG1iLTYgYm9yZGVyLWIgYm9yZGVyLXdoaXRlLzEwIHBiLTQiLCBjaGlsZHJlbjogIlZpc3VhbCBTZXR0aW5ncyIgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInNwYWNlLXktNiIsIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdyb3VwIiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyIsIGNoaWxkcmVuOiBbX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6IGBwLTIgcm91bmRlZCAke3NldHRpbmdzLnJheVRyYWNpbmcgPyAnYmctYmx1ZS01MDAvMjAgdGV4dC1ibHVlLTQwMCcgOiAnYmctd2hpdGUvNSB0ZXh0LWdyYXktNDAwJ31gLCBjaGlsZHJlbjogX2pzeChDcHUsIHsgc2l6ZTogMjQgfSkgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInRleHQtbGVmdCIsIGNoaWxkcmVuOiBbX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJmb250LWJvbGQiLCBjaGlsZHJlbjogIlJheSBUcmFjaW5nIiB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhzIHRleHQtZ3JheS00MDAiLCBjaGlsZHJlbjogIlJETkEgMiAvIFJUWCAvIE0tU2VyaWVzIiB9KV0gfSldIH0pLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IHRvZ2dsZVNldHRpbmcoJ3JheVRyYWNpbmcnKSwgY2xhc3NOYW1lOiBgdy0xMiBoLTYgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tY29sb3JzIHJlbGF0aXZlICR7c2V0dGluZ3MucmF5VHJhY2luZyA/ICdiZy1ibHVlLTUwMCcgOiAnYmctZ3JheS03MDAnfWAsIGNoaWxkcmVuOiBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogYGFic29sdXRlIHRvcC0xIHctNCBoLTQgYmctd2hpdGUgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tYWxsICR7c2V0dGluZ3MucmF5VHJhY2luZyA/ICdsZWZ0LTcnIDogJ2xlZnQtMSd9YCB9KSB9KV0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBncm91cCIsIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiBgcC0yIHJvdW5kZWQgJHtzZXR0aW5ncy5wYXJ0aWNsZXMgPyAnYmctcHVycGxlLTUwMC8yMCB0ZXh0LXB1cnBsZS00MDAnIDogJ2JnLXdoaXRlLzUgdGV4dC1ncmF5LTQwMCd9YCwgY2hpbGRyZW46IF9qc3goTW9uaXRvciwgeyBzaXplOiAyNCB9KSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC1sZWZ0IiwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImZvbnQtYm9sZCIsIGNoaWxkcmVuOiAiUGFydGljbGVzICYgRlgiIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInRleHQteHMgdGV4dC1ncmF5LTQwMCIsIGNoaWxkcmVuOiAiSGlnaCBGaWRlbGl0eSBBdG1vc3BoZXJlIiB9KV0gfSldIH0pLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IHRvZ2dsZVNldHRpbmcoJ3BhcnRpY2xlcycpLCBjbGFzc05hbWU6IGB3LTEyIGgtNiByb3VuZGVkLWZ1bGwgdHJhbnNpdGlvbi1jb2xvcnMgcmVsYXRpdmUgJHtzZXR0aW5ncy5wYXJ0aWNsZXMgPyAnYmctcHVycGxlLTUwMCcgOiAnYmctZ3JheS03MDAnfWAsIGNoaWxkcmVuOiBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogYGFic29sdXRlIHRvcC0xIHctNCBoLTQgYmctd2hpdGUgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tYWxsICR7c2V0dGluZ3MucGFydGljbGVzID8gJ2xlZnQtNycgOiAnbGVmdC0xJ31gIH0pIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdyb3VwIGN1cnNvci1wb2ludGVyIiwgb25DbGljazogY3ljbGVDb2xvciwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyIsIGNoaWxkcmVuOiBbX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJwLTIgcm91bmRlZCBiZy13aGl0ZS81IHRleHQtZ3JheS00MDAiLCBjaGlsZHJlbjogX2pzeChQYWxldHRlLCB7IHNpemU6IDI0IH0pIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWxlZnQiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIiwgY2hpbGRyZW46ICJDaGFyYWN0ZXIiIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInRleHQteHMgdGV4dC1ncmF5LTQwMCIsIHN0eWxlOiB7IGNvbG9yOiBzZXR0aW5ncy5wbGF5ZXJDb2xvciB9LCBjaGlsZHJlbjogY3VycmVudENvbG9yTmFtZSB9KV0gfSldIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInctNiBoLTYgcm91bmRlZC1mdWxsIGJvcmRlciBib3JkZXItd2hpdGUvMzAiLCBzdHlsZTogeyBiYWNrZ3JvdW5kQ29sb3I6IHNldHRpbmdzLnBsYXllckNvbG9yIH0gfSldIH0pXSB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBzZXRTaG93U2V0dGluZ3MoZmFsc2UpLCBjbGFzc05hbWU6ICJtdC04IHctZnVsbCBweS0zIGJnLXdoaXRlLzEwIGhvdmVyOmJnLXdoaXRlLzIwIHRyYW5zaXRpb24tYWxsIGZvbnQtYm9sZCIsIGNoaWxkcmVuOiAiQkFDSyIgfSldIH0pKV0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGJvdHRvbS04IHRleHQtd2hpdGUvMzAgdGV4dC14cyBmbGV4IGdhcC00IiwgY2hpbGRyZW46IFtfanN4KCJzcGFuIiwgeyBjaGlsZHJlbjogInYxLjAuMCIgfSksIF9qc3goInNwYW4iLCB7IGNoaWxkcmVuOiAiXHUyMDIyIiB9KSwgX2pzeCgic3BhbiIsIHsgY2hpbGRyZW46ICJNYWRlIGZvciBGbG91bmRlci5uZXdzIiB9KV0gfSldIH0pKTsKfTsK","@/App":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnOwppbXBvcnQgeyBNYWluTWVudSB9IGZyb20gJ0AvY29tcG9uZW50cy9NYWluTWVudSc7CmltcG9ydCB7IEdhbWUgfSBmcm9tICdAL2NvbXBvbmVudHMvR2FtZSc7CmltcG9ydCB7IFBMQVlFUl9DT0xPUlMgfSBmcm9tICdAL2NvbnN0YW50cyc7CmZ1bmN0aW9uIEFwcCgpIHsKICAgIGNvbnN0IFt2aWV3LCBzZXRWaWV3XSA9IHVzZVN0YXRlKCdtZW51Jyk7CiAgICBjb25zdCBbc2V0dGluZ3MsIHNldFNldHRpbmdzXSA9IHVzZVN0YXRlKHsKICAgICAgICByYXlUcmFjaW5nOiB0cnVlLCAvLyBEZWZhdWx0IHRvIG9uIGZvciB0aGUgd293IGZhY3RvcgogICAgICAgIHBhcnRpY2xlczogdHJ1ZSwKICAgICAgICBtdXNpY1ZvbHVtZTogMC41LAogICAgICAgIHNmeFZvbHVtZTogMC41LAogICAgICAgIHBsYXllckNvbG9yOiBQTEFZRVJfQ09MT1JTWzBdLnZhbHVlCiAgICB9KTsKICAgIGNvbnN0IGhhbmRsZVN0YXJ0ID0gKCkgPT4gc2V0VmlldygnZ2FtZScpOwogICAgY29uc3QgaGFuZGxlRXhpdCA9ICgpID0+IHNldFZpZXcoJ21lbnUnKTsKICAgIGNvbnN0IGhhbmRsZVdpbiA9ICgpID0+IHNldFZpZXcoJ3dpbicpOwogICAgcmV0dXJuIChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmb250LXNhbnMgYW50aWFsaWFzZWQgdGV4dC1ncmF5LTkwMCIsIGNoaWxkcmVuOiBbdmlldyA9PT0gJ21lbnUnICYmIChfanN4KE1haW5NZW51LCB7IG9uU3RhcnQ6IGhhbmRsZVN0YXJ0LCBzZXR0aW5nczogc2V0dGluZ3MsIHNldFNldHRpbmdzOiBzZXRTZXR0aW5ncyB9KSksIHZpZXcgPT09ICdnYW1lJyAmJiAoX2pzeChHYW1lLCB7IHNldHRpbmdzOiBzZXR0aW5ncywgb25FeGl0OiBoYW5kbGVFeGl0LCBvbldpbjogaGFuZGxlV2luIH0pKSwgdmlldyA9PT0gJ3dpbicgJiYgKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAidy1mdWxsIGgtc2NyZWVuIGJnLWJsYWNrIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtd2hpdGUgcC04IHRleHQtY2VudGVyIGFuaW1hdGUtZmFkZS1pbiIsIGNoaWxkcmVuOiBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJtYXgtdy0yeGwiLCBjaGlsZHJlbjogW19qc3goImgxIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LTZ4bCBmb250LWNpbnplbCB0ZXh0LXllbGxvdy01MDAgbWItNiBkcm9wLXNoYWRvdy1bMF8wXzI1cHhfcmdiYSgyMzQsMTc5LDgsMC41KV0iLCBjaGlsZHJlbjogIlZJQ1RPUlkiIH0pLCBfanN4KCJwIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIG9wYWNpdHktODAgbWItOCBsZWFkaW5nLXJlbGF4ZWQiLCBjaGlsZHJlbjogIllvdSBoYXZlIG5hdmlnYXRlZCB0aGUgdHJlYWNoZXJvdXMgZGVwdGhzIG9mIHRoZSBwcmludGluZyBwcmVzcywgZGVmZWF0ZWQgdGhlIGVkaXRvcnMgb2YgY2hhb3MsIGFuZCBkZWxpdmVyZWQgdGhlIHRydXRoIHRvIHRoZSBtYXNzZXMuIFRoZSBGbG91bmRlciBDaHJvbmljbGUgY29udGludWVzLiIgfSksIF9qc3goImJ1dHRvbiIsIHsgb25DbGljazogaGFuZGxlRXhpdCwgY2xhc3NOYW1lOiAicHgtOCBweS00IGJnLXdoaXRlIHRleHQtYmxhY2sgZm9udC1ib2xkIHRleHQtbGcgaG92ZXI6c2NhbGUtMTA1IHRyYW5zaXRpb24tdHJhbnNmb3JtIiwgY2hpbGRyZW46ICJSRVRVUk4gVE8gTUVOVSIgfSldIH0pIH0pKV0gfSkpOwp9CmV4cG9ydCBkZWZhdWx0IEFwcDsK","@/utils/audio":"data:application/javascript;base64,ZXhwb3J0IGNsYXNzIEF1ZGlvQ29udHJvbGxlciB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmN0eCA9IG51bGw7CiAgICAgICAgdGhpcy5tYXN0ZXJHYWluID0gbnVsbDsKICAgIH0KICAgIGluaXQoKSB7CiAgICAgICAgaWYgKHRoaXMuY3R4KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgQXVkaW9Db250ZXh0Q2xhc3MgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQ7CiAgICAgICAgICAgIHRoaXMuY3R4ID0gbmV3IEF1ZGlvQ29udGV4dENsYXNzKCk7CiAgICAgICAgICAgIHRoaXMubWFzdGVyR2FpbiA9IHRoaXMuY3R4LmNyZWF0ZUdhaW4oKTsKICAgICAgICAgICAgdGhpcy5tYXN0ZXJHYWluLmNvbm5lY3QodGhpcy5jdHguZGVzdGluYXRpb24pOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oJ0F1ZGlvQ29udGV4dCBub3Qgc3VwcG9ydGVkJywgZSk7CiAgICAgICAgfQogICAgfQogICAgc2V0Vm9sdW1lKHZvbHVtZSkgewogICAgICAgIGlmICh0aGlzLm1hc3RlckdhaW4pIHsKICAgICAgICAgICAgLy8gQ2xhbXAgdm9sdW1lIDAtMQogICAgICAgICAgICBjb25zdCB2ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgdm9sdW1lKSk7CiAgICAgICAgICAgIHRoaXMubWFzdGVyR2Fpbi5nYWluLnNldFRhcmdldEF0VGltZSh2LCB0aGlzLmN0eD8uY3VycmVudFRpbWUgfHwgMCwgMC4xKTsKICAgICAgICB9CiAgICB9CiAgICBwbGF5SnVtcCgpIHsKICAgICAgICB0aGlzLnBsYXlUb25lKDE1MCwgJ3NpbmUnLCAwLjE1LCAzMDAsIDAuMyk7CiAgICB9CiAgICBwbGF5Q29sbGVjdCgpIHsKICAgICAgICB0aGlzLnBsYXlUb25lKDg4MCwgJ3NpbmUnLCAwLjEsIDE3NjAsIDAuMik7CiAgICB9CiAgICBwbGF5RGFtYWdlKCkgewogICAgICAgIHRoaXMucGxheVRvbmUoMTUwLCAnc2F3dG9vdGgnLCAwLjMsIDUwLCAwLjQpOwogICAgfQogICAgcGxheUVuZW15RGVhdGgoKSB7CiAgICAgICAgdGhpcy5wbGF5VG9uZSgyMDAsICdzcXVhcmUnLCAwLjE1LCA1MCwgMC4yKTsKICAgIH0KICAgIHBsYXlTaG9vdCgpIHsKICAgICAgICB0aGlzLnBsYXlUb25lKDQwMCwgJ3RyaWFuZ2xlJywgMC4xLCAxMDAsIDAuMik7CiAgICB9CiAgICBwbGF5U3RlcCgpIHsKICAgICAgICAvLyBWZXJ5IHN1YnRsZSBub2lzZSBmb3Igc3RlcHBpbmc/IE1heWJlIHNraXAgZm9yIG5vdyB0byBhdm9pZCBub2lzZQogICAgfQogICAgcGxheVRvbmUoZnJlcSwgdHlwZSwgZHVyYXRpb24sIGVuZEZyZXEsIHZvbCA9IDAuNSkgewogICAgICAgIGlmICghdGhpcy5jdHggfHwgIXRoaXMubWFzdGVyR2FpbikKICAgICAgICAgICAgdGhpcy5pbml0KCk7CiAgICAgICAgaWYgKCF0aGlzLmN0eCB8fCAhdGhpcy5tYXN0ZXJHYWluKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgLy8gUmVzdW1lIGNvbnRleHQgaWYgc3VzcGVuZGVkIChjb21tb24gaW4gYnJvd3NlcnMpCiAgICAgICAgaWYgKHRoaXMuY3R4LnN0YXRlID09PSAnc3VzcGVuZGVkJykgewogICAgICAgICAgICB0aGlzLmN0eC5yZXN1bWUoKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb3NjID0gdGhpcy5jdHguY3JlYXRlT3NjaWxsYXRvcigpOwogICAgICAgIGNvbnN0IGdhaW4gPSB0aGlzLmN0eC5jcmVhdGVHYWluKCk7CiAgICAgICAgb3NjLmNvbm5lY3QoZ2Fpbik7CiAgICAgICAgZ2Fpbi5jb25uZWN0KHRoaXMubWFzdGVyR2Fpbik7CiAgICAgICAgb3NjLnR5cGUgPSB0eXBlOwogICAgICAgIG9zYy5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoZnJlcSwgdGhpcy5jdHguY3VycmVudFRpbWUpOwogICAgICAgIGlmIChlbmRGcmVxKSB7CiAgICAgICAgICAgIG9zYy5mcmVxdWVuY3kuZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZShlbmRGcmVxLCB0aGlzLmN0eC5jdXJyZW50VGltZSArIGR1cmF0aW9uKTsKICAgICAgICB9CiAgICAgICAgZ2Fpbi5nYWluLnNldFZhbHVlQXRUaW1lKHZvbCwgdGhpcy5jdHguY3VycmVudFRpbWUpOwogICAgICAgIGdhaW4uZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDAxLCB0aGlzLmN0eC5jdXJyZW50VGltZSArIGR1cmF0aW9uKTsKICAgICAgICBvc2Muc3RhcnQoKTsKICAgICAgICBvc2Muc3RvcCh0aGlzLmN0eC5jdXJyZW50VGltZSArIGR1cmF0aW9uKTsKICAgIH0KfQpleHBvcnQgY29uc3QgYXVkaW9NYW5hZ2VyID0gbmV3IEF1ZGlvQ29udHJvbGxlcigpOwo="}}</script>
<script>
window.APPLET_FILES = ["index.tsx", "metadata.json", "index.html", "types.ts", "constants.ts", "utils/geometry.ts", "services/LevelGenerator.ts", "components/Game.tsx", "components/MainMenu.tsx", "App.tsx", "utils/audio.ts"];
</script>
<script type="module">
(() => {
    if (window.self === window.top) {
        // Do not run the shim in the main window, only in iframes.
        return;
    }

    window.API_KEY = 'GEMINI_API_KEY';
    window.GEMINI_API_KEY = 'GEMINI_API_KEY';
    window.process = window.process || {};
    window.process.env = window.process.env || {};
    window.process.env.API_KEY = window.API_KEY;
    window.process.env.GEMINI_API_KEY = window.GEMINI_API_KEY;

    const bootstrapChannel = new Promise((resolve) => {
        window.addEventListener('message', (event) => {
            if (event.origin !== 'https://aistudio.google.com') {
                return;
            }

            if (event.data.type === 'bootstrap') {
                resolve({
                    port: event.ports[0],
                    urlPatterns:
                    event.data.urlPatterns.map((pattern) => new RegExp(pattern)),
                });
            }
        });
    });

    window.aistudio = window.aistudio || {
        handleFullscreenEsc: true,
        getHostUrl: async function() {
            const hostPort = (await bootstrapChannel).port;
            return new Promise((resolve) => {
                const channel = new MessageChannel();
                hostPort.postMessage(
                {
                    type: 'get_host_url'
                },
                [channel.port2]);
                const port = channel.port1;
                port.onmessage = (message) => {
                    resolve(message.data.url);
                };
            });
        },
        hasSelectedApiKey: async function() {
            const hostPort = (await bootstrapChannel).port;
            return new Promise((resolve) => {
                const channel = new MessageChannel();
                hostPort.postMessage(
                {
                    type: 'has_selected_api_key'
                },
                [channel.port2]);
                const port = channel.port1;
                port.onmessage = (message) => {
                    resolve(message.data);
                };
            });
        },
        openSelectKey: async function() {
            const hostPort = (await bootstrapChannel).port;
            const channel = new MessageChannel();
            hostPort.postMessage(
            {
                type: 'open_select_key'
            },
            [channel.port2]);
        },
        getModelQuota: async function(model) {
            const hostPort = (await bootstrapChannel).port;
            return new Promise((resolve) => {
                const channel = new MessageChannel();
                hostPort.postMessage(
                {
                    type: 'get_model_quota',
                    model
                },
                [channel.port2]);
                const port = channel.port1;
                port.onmessage = (message) => {
                    resolve(message.data.modelQuota);
                };
            });
        },
    };

    const nativeFetch = window.fetch;

    /**
       * @param {string | URL | Request} resource The resource of the fetch request.
       * @param {RequestInit} options The options of the fetch request.
       * @return {Promise!} The promise of the fetch request.
       */
    async function fetch(resource, options) {
        const config = await bootstrapChannel;

        const request = resource instanceof Request ?
        resource.clone() :
        new Request(resource, options);

        if (!config.urlPatterns.some((pattern) => request.url.match(pattern))) {
            return nativeFetch(resource, options);
        }
        const hostPort = config.port;

        const channel = new MessageChannel();
        const port = channel.port1;
        let bodyBytes;
        const transfer = [channel.port2];
        const parts = [];
        const buffer = await request.arrayBuffer();
        if (buffer.byteLength) {
            bodyBytes = buffer;
            transfer.push(bodyBytes);
        }
        hostPort.postMessage(
        {
            type: 'fetch',
            url: request.url,
            method: request.method,
            headers: [...request.headers.entries()],
            body: bodyBytes,
        },
        transfer);

        let streamController;
        const body = new ReadableStream({
            start(controller) {
                streamController = controller;
            },
        });
        let resolveReceive;
        const receivePromise = new Promise((resolve) => {
            resolveReceive = resolve;
        });
        port.onmessage = (message) => {
            switch (message.data.type) {
            case 'response':
                resolveReceive(new Response(body, {
                    status: message.data.status,
                    statusText: message.data.statusText,
                    headers: new Headers(message.data.headers),
                }));
                break;
            case 'body':
                streamController.enqueue(message.data.data);
                break;
            case 'body_done':
                streamController.close();
                break;
            }
        };
        return receivePromise;
    }

    Object.defineProperty(window, 'fetch', {
        get: function() {
            return fetch;
        },
    });

    // See details in: https://github.com/angular/angular/issues/63064.
    function patchHistoryStateFunctionForAngular(originalFn, baseHref) {
        return (state, unused, url) => {
            if (typeof url === 'string' && !url.startsWith('blob:')) {
                url = baseHref + url;
            }
            return originalFn.apply(window.history, [state, unused, url]);
        };
    }

    if (false) {
        const baseHref = window.location.href;
        window.history.replaceState = patchHistoryStateFunctionForAngular(window.history.replaceState, baseHref);
        window.history.pushState = patchHistoryStateFunctionForAngular(window.history.pushState, baseHref);
    }

    const originalWebSocket = window.WebSocket;
    class ProxiedWebSocket extends EventTarget {
        /**
             * @param {string} url The url of the websocket.
             * @param {Object!} protocols The protocols of the websocket.
             */
        constructor(url, protocols)
        {
            super();
            this.url = url;
            this.protocols = protocols;

            this.open();
        }

        /** Opens the websocket. */
        async open()
        {
            const hostPort = (await bootstrapChannel).port;
            const channel = new MessageChannel();
            hostPort.postMessage(
            {
                type: 'websocket_open',
                url: this.url,
                protocols: this.protocols
            },
            [channel.port2]);
            this.port = channel.port1;
            this.port.onmessage = (message) => {
                if (message.data.type === 'close') {
                    const event = new CloseEvent('close', {
                        code: message.data.code,
                        reason: message.data.reason,
                        wasClean: message.data.wasClean,
                    });
                    if (this.onclose) {
                        this.onclose(event);
                    }
                    this.dispatchEvent(event);
                    return;
                } else if (message.data.type === 'open') {
                    const event = new Event('open');
                    if (this.onopen) {
                        this.onopen(event);
                    }
                    this.dispatchEvent(event);
                    return;
                } else if (message.data.type === 'message') {
                    let data = message.data.data;
                    if (message.data.messageType === 'text' || message.data.messageType === 'message') {
                        data = new TextDecoder().decode(data);
                    }
                    const event = new MessageEvent('message', {
                        data,
                        type: message.data.messageType,
                    });
                    if (this.onmessage) {
                        this.onmessage(event);
                    }
                    this.dispatchEvent(event);
                    return;
                } else if (message.data.type === 'error') {
                    const event = new ErrorEvent('error', {
                        message: message.data.message,
                    });
                    if (this.onerror) {
                        this.onerror(event);
                    }
                    this.dispatchEvent(event);
                    return;
                }
                console.error('received unknown message in frame', event.data);
            };
        }
        /**
             * @param {string|ArrayBuffer!} data The data to send.
             */
        send(data)
        {
            if (typeof data === 'string') {
                this.port.postMessage({
                    type: 'send',
                    data
                });
            } else {
                this.port.postMessage({
                    type: 'send',
                    data
                }, [data.buffer]);
            }
        }

        /**
             * @param {number} code The code of the close event.
             * @param {string} reason The reason of the close event.
             */
        close(code, reason)
        {
            this.port.postMessage({
                type: 'close',
                code,
                reason
            });
        }
    }

    /**
       * @param {string} url The url of the websocket.
       * @param {Object!} protocols The protocols of the websocket.
       * @return {WebSocket!} The websocket.
       */
    function createWebSocket(url, protocols) {
        // This should come from the bootstrap channel, but we want this to
        // work for the synchronous constructor here.
        if (url.startsWith('wss://generativelanguage.googleapis.com/')) {
            return Reflect.construct(ProxiedWebSocket, [url, protocols]);
        }
        return Reflect.construct(originalWebSocket, [url, protocols]);
    }

    Object.defineProperty(window, 'WebSocket', {
        get: function() {
            return createWebSocket;
        },
    });

    async function instrumentErrorReporting() {
        const errors = [];
        let hostPort;

        function reportError(message) {
            if (!hostPort) {
                errors.push(message);
            } else {
                hostPort.postMessage({
                    type: 'error',
                    message: message
                }, message);
            }
        }

        function serialize(args) {
            return args.map((a) => {
                if (a instanceof Error || a instanceof ErrorEvent) {
                    return a.message;
                }
                if (a instanceof CloseEvent) {
                    return {
                        code: a.code,
                        reason: a.reason,
                        wasClean: a.wasClean
                    };
                }
                if (a instanceof Map) {
                    return JSON.parse(JSON.stringify([...a.entries()]));
                }
                if (a instanceof Set) {
                    return JSON.parse(JSON.stringify([...a.values()]));
                }
                if (a instanceof Object) {
                    return JSON.parse(JSON.stringify(a));
                }
                return a;
            });
        }

        const originalConsole = window.console;
        const originalConsoleLog = window.console.log;
        const originalConsoleError = window.console.error;
        const originalConsoleWarn = window.console.warn;
        const originalConsoleDebug = window.console.debug;
        window.console = {
            ...originalConsole,
            log: (message, ...args) => {
                originalConsoleLog.apply(window.console, [message, ...args]);
                const combined = serialize([message, ...args]);
                reportError({
                    type: 'console_log',
                    message: combined
                });
            },
            debug: (message, ...args) => {
                originalConsoleDebug.apply(window.console, [message, ...args]);
                const combined = serialize([message, ...args]);
                reportError({
                    type: 'console_debug',
                    message: combined
                });
            },
            error: (message, ...args) => {
                originalConsoleError.apply(window.console, [message, ...args]);
                const combined = serialize([message, ...args]);
                reportError({
                    type: 'console_error',
                    message: combined
                });
            },
            warn: (message, ...args) => {
                originalConsoleWarn.apply(window.console, [message, ...args]);
                const combined = serialize([message, ...args]);
                reportError({
                    type: 'console_warn',
                    message: combined
                });
            },
        };

        window.onerror = (message, source, lineno, colno, error) => {
            reportError({
                type: 'error',
                message: serialize([message]),
                source,
                lineno,
                colno,
                error
            });
        };

        window.onunhandledrejection = (event) => {
            reportError({
                type: 'unhandledrejection',
                message: serialize([event.reason])
            });
        };

        window.alert = (message) => {
            reportError({
                type: 'alert',
                message: serialize([message])
            });
        };

        hostPort = (await bootstrapChannel).port;
        for (const error of errors) {
            hostPort.postMessage({
                type: 'error',
                message: error
            });
        }
    }

    const availableFiles = new Set(window.APPLET_FILES || []);

    instrumentErrorReporting();

    if (false) {
        const notifyLocationChange = async () => {
            const hostPort = (await bootstrapChannel).port;
            hostPort.postMessage({
                type: 'locationchange',
                href: location.href
            });
        };

        // Send initial state on load.
        notifyLocationChange();

        const originalPushState = history.pushState;
        history.pushState = (...args) => {
            originalPushState.apply(history, args);
            notifyLocationChange();
        };

        const originalReplaceState = history.replaceState;
        history.replaceState = (...args) => {
            originalReplaceState.apply(history, args);
            notifyLocationChange();
        };
        window.addEventListener('popstate', (e) => {
            notifyLocationChange();
        });
    }

    window.addEventListener('hashchange', async (e) => {
        const config = await bootstrapChannel;
        const hostPort = config.port;
        hostPort.postMessage({
            type: 'hashchange',
            hash: window.location.hash
        });
        if (false) {
            hostPort.postMessage({
                type: 'locationchange',
                href: location.href,
            });
        }
    });

    if (true) {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/html2canvas-pro';
        script.onload = () => {
            window.addEventListener('message', async (event) => {
                if (event.data?.type === 'capture-screenshot') {
                    try {
                        const canvas = await html2canvas(document.documentElement, {
                            logging: false,
                            useCORS: true,
                            backgroundColor: null,
                            scale: 1,
                        });
                        const hostPort = (await bootstrapChannel).port;
                        hostPort.postMessage(
                        {
                            type: 'screenshot-result',
                            dataUrl: canvas.toDataURL('image/png'),
                            requestId: event.data.requestId,
                            scrollX: document.body.scrollLeft,
                            scrollY: document.body.scrollTop,
                        },
                        );
                    } catch (e) {
                        const hostPort = (await bootstrapChannel).port;
                        hostPort.postMessage(
                        {
                            type: 'screenshot-error',
                            error: e.message,
                            requestId: event.data.requestId,
                        });
                    }
                }
            });
        };
        document.head.appendChild(script);
    }

    if (false) {
        const MAX_ANCESTOR_LEVEL = 3;
        const MAX_DESCENDANT_LEVEL = 3;

        function getElementSelector(el) {
            if (!el || el.nodeType !== 1) {
                return '';
            }
            const parts = [];
            while (el && el.nodeType === 1 && el.tagName.toLowerCase() !== 'body') {
                let part = el.tagName.toLowerCase();
                if (el.id) {
                    part += '#' + CSS.escape(el.id);
                }

                const parent = el.parentElement;
                if (parent) {
                    let nth = 1;
                    let prev = el.previousElementSibling;
                    while (prev) {
                        if (prev.tagName === el.tagName) {
                            nth++;
                        }
                        prev = prev.previousElementSibling;
                    }
                    part += ':nth-of-type(' + nth + ')';
                }

                parts.unshift(part);
                el = el.parentElement;
            }
            return parts.join(' > ');
        }

        function getDomTreeAsString(element, depth, maxDepth) {
            if (!element || element.nodeType !== 1 || depth > maxDepth) {
                return '';
            }
            const tagName = element.tagName.toLowerCase();
            let attrs = [];
            if (element.id) {
                attrs.push('id="' + element.id + '"');
            }
            if (element.classList.length > 0) {
                attrs.push('class="' + element.classList.value + '"');
            }
            const attrString = attrs.length > 0 ? ' ' + attrs.join(' ') : '';

            let content = '';
            for (const node of element.childNodes) {
                if (node.nodeType === 1) {
                    // Element node
                    content += getDomTreeAsString(node, depth + 1, maxDepth);
                } else if (node.nodeType === 3) {
                    // Text node
                    content += node.textContent;
                }
            }

            return '<' + tagName + attrString + '>' + content + '</' + tagName + '>';
        }

        const style = document.createElement('style');
        style.textContent =
        '.aistudio-focus-mode-highlight { box-shadow: inset 0 0 0 0.5px white, inset 0 0 0 1.5px #87a9ff !important; }' +
        '#aistudio-focus-mode-tag { position: absolute; display: none; background: #87a9ff; border-radius: 4px; border: 0.5px solid white; z-index: 10000; text-transform: lowercase; padding: 2px 4px; color: #32302c; font-family: Inter, sans-serif; font-size: 12px; font-style: normal; font-weight: 400; line-height: 16px; pointer-events: none; }';
        document.head.appendChild(style);

        let highlightedElement = null;
        let focusTag = null;
        let resizeObserver = null;
        let iframeLoaded = false;

        function positionFocusTag() {
            if (!highlightedElement || !focusTag)
                return;
            requestAnimationFrame(() => {
                focusTag.style.display = 'inline-flex';
                const rect = highlightedElement.getBoundingClientRect();
                focusTag.style.top =
                rect.top + window.scrollY - focusTag.offsetHeight - 5 + 'px';
                focusTag.style.left = rect.left + window.scrollX + 'px';
            });
        }

        if (window.ResizeObserver) {
            resizeObserver = new ResizeObserver(() => {
                positionFocusTag();
            });
        }

        function highlight(element) {
            if (!iframeLoaded)
                return; // Do not highlight if iframe is not loaded
            if (!focusTag) {
                focusTag = document.createElement('div');
                focusTag.id = 'aistudio-focus-mode-tag';
                document.body.appendChild(focusTag);
            }

            const hadHighlightedElement = !!highlightedElement;
            if (highlightedElement) {
                highlightedElement.classList.remove('aistudio-focus-mode-highlight');
                highlightedElement.removeAttribute('data-aistudio-tag-name');
                if (resizeObserver) {
                    resizeObserver.unobserve(highlightedElement);
                }
            }
            focusTag.style.display = 'none';
            highlightedElement = element;
            const hasHighlightedElement = !!highlightedElement;

            if (!hadHighlightedElement && hasHighlightedElement) {
                window.addEventListener('resize', positionFocusTag);
                window.addEventListener('scroll', positionFocusTag, true);
            } else if (hadHighlightedElement && !hasHighlightedElement) {
                window.removeEventListener('resize', positionFocusTag);
                window.removeEventListener('scroll', positionFocusTag, true);
            }

            if (highlightedElement) {
                highlightedElement.setAttribute(
                'data-aistudio-tag-name',
                highlightedElement.tagName,
                );
                highlightedElement.classList.add('aistudio-focus-mode-highlight');
                focusTag.textContent = highlightedElement.tagName.toLowerCase();
                positionFocusTag();
                if (resizeObserver) {
                    resizeObserver.observe(highlightedElement);
                }
            }
        }

        window.addEventListener('load', () => {
            iframeLoaded = true;
        });

        window.addEventListener('message', async (event) => {
            if (event.data?.type === 'highlight-element-at-point') {
                try {
                    const element = document.elementFromPoint(
                    event.data.x,
                    event.data.y,
                    );
                    highlight(element);
                } catch (e) {
                    highlight(null);
                }
            } else if (event.data?.type === 'highlight-element-by-selector') {
                try {
                    const selector = event.data.selector;
                    if (selector) {
                        const element = document.querySelector(selector);
                        highlight(element);
                    } else {
                        highlight(null);
                    }
                } catch (e) {
                    highlight(null);
                }
            } else if (event.data?.type === 'get-element-at-point') {
                try {
                    const element = document.elementFromPoint(
                    event.data.x,
                    event.data.y,
                    );
                    const hostPort = (await bootstrapChannel).port;
                    if (!element) {
                        hostPort.postMessage({
                            type: 'element-at-point-error',
                            error: 'No element found at point',
                            requestId: event.data.requestId,
                        });
                        return;
                    }
                    const selector = getElementSelector(element);

                    let levelsUp = 0;
                    let root = element;
                    while (levelsUp < MAX_ANCESTOR_LEVEL && root.parentElement && root.parentElement.tagName.toLowerCase() !== 'html') {
                        root = root.parentElement;
                        levelsUp++;
                    }
                    const domString = getDomTreeAsString(root, 0, levelsUp + MAX_DESCENDANT_LEVEL);

                    const styles = window.getComputedStyle(element);
                    const css = {};
                    for (let i = 0; i < styles.length; i++) {
                        const key = styles[i];
                        css[key] = styles.getPropertyValue(key);
                    }
                    hostPort.postMessage({
                        type: 'element-at-point-result',
                        element: {
                            selector: selector,
                            domString: domString,
                            css: css,
                            x: event.data.x,
                            y: event.data.y,
                        },
                        requestId: event.data.requestId,
                    });
                } catch (e) {
                    const hostPort = (await bootstrapChannel).port;
                    hostPort.postMessage({
                        type: 'element-at-point-error',
                        error: e.message,
                        requestId: event.data.requestId,
                    });
                }
            } else if (event.data?.type === 'change-element-style') {
                try {
                    const selector = event.data.selector;
                    if (selector) {
                        const element = document.querySelector(selector);
                        if (element) {
                            element.style.setProperty(
                            event.data.property,
                            event.data.value,
                            'important',
                            );
                            positionFocusTag();
                        }
                    }
                } catch (e) {}
            }
        });
    }

    window.addEventListener('keydown', async (event) => {
        if (event.key === 'Escape' && window.aistudio?.handleFullscreenEsc) {
            const hostPort = (await bootstrapChannel).port;
            hostPort.postMessage({
                type: 'exit-fullscreen'
            });
        }
    });
})();
// # sourceURL=iframe_shim.js
</script>
<base href="https://ai.studio"/>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>The Flounder Chronicles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap');
    body {
        margin: 0;
        background-color: #050505;
        overflow: hidden;
        font-family: 'Lato', sans-serif;
    }

    canvas {
        display: block;
    }

    .font-cinzel {
        font-family: 'Cinzel', serif;
    }
    </style>
</head>
<body>
    <div id="root"></div>
</body>
</html>
<script type="module" onerror="console.warn('Failed to load the app. Try reloading it.')">
import '@/index';
</script>
